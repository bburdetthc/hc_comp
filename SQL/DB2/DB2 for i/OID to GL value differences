SELECT
	X.*, DHCURR, DHCOMP, DIINV#, DILIN#, DIGLCD, DIPART
FROM
	(
	SELECT
		INVOICE, ROUND(SUM(OIH),2) OID, ROUND(SUM(GL),2) GL, ROUND(SUM(OIH) - SUM(GL),2) DIFF
	FROM
		( 
			SELECT
				RTRIM(CUSKEY1)||RTRIM(CUSKEY2) INVOICE, 0 OIH, ROUND(SUM(AMOUNT),2) GL
			FROM
				RLARP.VW_GLLCS
			WHERE
				FSPR = '1606' AND
				MODULE = 'ICIN' AND
				SUBSTR(FGRP,1,5) = '51010'
			GROUP BY
				RTRIM(CUSKEY1)||RTRIM(CUSKEY2)
			
			UNION ALL
			
			SELECT
				DIGITS(DHINV#)||DIGITS(DILIN#) INVOICE, ROUND(DICTEX*CASE DHINCR WHEN 'C' THEN -1 ELSE 1 END*CX.RATE,2) OIH, 0 GL
			FROM
				LGDAT.OIH 
				INNER JOIN LGDAT.OID ON 
					DIINV# = DHINV# 
				LEFT OUTER JOIN LGDAT.OCRH ON 
					DCORD# = DHORD# 
				LEFT OUTER JOIN LGDAT.CUST BC ON 
					BC.BVCUST = DHBCS# 
				LEFT OUTER JOIN LGDAT.CUST SC ON 
					SC.BVCUST = DHSCS# 
				LEFT OUTER JOIN RLARP.VW_FFITEMM ON 
					ITEM = DIPART 
				LEFT OUTER JOIN LGDAT.PLNT ON 
					YAPLNT = DHPLNT 
				LEFT OUTER JOIN LGDAT.GLIE ON 
					Y1PLNT = DHPLNT AND 
					Y1GLEC = GLEC 
				LEFT OUTER JOIN LGDAT.ARMASC ON 
					ZWCOMP = BC.BVCOMP AND 
					ZWKEY1 = BC.BVARCD AND 
					ZWKEY2 = DIGLCD 
				LEFT OUTER JOIN RLARP.FFCRET IX ON 
					IX.PERD = DIGITS(DHARYR)||DIGITS(DHARPR) AND 
					IX.FCUR = DHCURR AND 
					IX.TCUR = 'US' AND 
					IX.RTYP = 'MA' 
				LEFT OUTER JOIN RLARP.VW_FFCOPR ON 
					COMP = DHCOMP 
				LEFT OUTER JOIN RLARP.FFCRET CX ON 
					CX.PERD = DIGITS(DHARYR)||DIGITS(DHARPR) AND 
					CX.FCUR = CURR AND 
					CX.TCUR = 'US' AND 
					CX.RTYP = 'MA'
				LEFT OUTER JOIN LGDAT.MAST ON 
					AZCOMP||DIGITS(AZGL#1)||DIGITS(AZGL#2) = DIGITS(ZWSAL#) 	 
				LEFT OUTER JOIN LGDAT.FGRP ON 
					BQ1GRP = AZGROP 
				LEFT OUTER JOIN RLARP.FFPERD ON 
					FSPR = DIGITS(DHARYR)||DIGITS(DHARPR) 
				LEFT OUTER JOIN RLARP.VW_FFTMCD T ON 
					TERM = DHTRCD 
			WHERE
				DHARYR = 16 AND
				DHARPR = 6 AND
				SUBSTR(AZGROP,1,5) = '41010'
		) U
	GROUP BY
		INVOICE
	HAVING
		ROUND(SUM(OIH) - SUM(GL),0) <> 0
	) X
	LEFT OUTER JOIN LGDAT.OID ON
			DIINV# = SUBSTR(INVOICE,1,9) AND
			DILIN# = SUBSTR(INVOICE,10,3)
	LEFT OUTER JOIN LGDAT.OIH ON
		DHINV# = DIINV#