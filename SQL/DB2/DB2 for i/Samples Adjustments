SELECT	
	BYPART , BYPLNT , BYSTOK , 
	SUBSTR ( DIGITS ( BYFSYY ) , 3 , 2 ) || DIGITS ( BYFSPR ) PERD , 
	BYREAS,BYJREF, BYSEQ#,
	YACOMP || O.Y1PADJ ORIG_ACCT , 
	AVGLED,
	COALESCE(DIGITS(BQ0ACCT),YACOMP || O.Y1PADJ) TARGET_ACCT, 
	GRP,
	COALESCE ( FCOST , STDCOST ) COST ,
	BYQTY * CASE BYACTN WHEN 'I' THEN - 1 ELSE 1 END BYQTY,
	COALESCE ( FCOST , STDCOST )*BYQTY * CASE BYACTN WHEN 'I' THEN - 1 ELSE 1 END EXT_COST
FROM
	LGDAT . STKT T
	LEFT OUTER JOIN RLARP . FFSTGR ON
		SRC = UPPER ( RTRIM ( BYSRC ) || SUBSTRING ( LTRIM ( BYREAS || BYDREF ) , 1 , 3 ) )
	LEFT OUTER JOIN RLARP . FFCOSTEFFD ON
		PART = BYPART AND
		PLNT = BYPLNT AND
		CHAR ( FDT ) || ' ' || CHAR ( FTM ) < CHAR ( BYSDAT ) || ' ' || CHAR ( BYSTIM ) AND
		CHAR ( TDT ) || ' ' || CHAR ( TTM ) > CHAR ( BYSDAT ) || ' ' || CHAR ( BYSTIM )
	LEFT OUTER JOIN RLARP . VW_FFICSTX ON
		V6PART = BYPART AND
		V6PLNT = BYPLNT
	INNER JOIN RLARP . VW_FFSTKMX ON
		AVPART = BYPART
	INNER JOIN LGDAT . PLNT ON
		YAPLNT = BYPLNT
	LEFT OUTER JOIN LGDAT . GLIE O ON
		O.Y1GLEC = AVGLED AND	
		O.Y1PLNT = BYPLNT
	LEFT OUTER JOIN LGDAT.MARC ON
		BQ0COMP = YACOMP AND
		BQ0PLNT = BYPLNT AND
		BQ0REAS = 'S'||SUBSTR(AVGLED,2,2) AND
		BQ0TYPE = 1
WHERE
	BYFSYY = 2016 AND
	--BYFSPR = 1 AND
	BYSTOK LIKE '152%' AND 
	BYSRC = 'INV' AND
	BYREAS IN ('SGR','SNU','SRE')