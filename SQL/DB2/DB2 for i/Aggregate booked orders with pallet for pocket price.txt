SELECT
	ORD_PERD, CALC_STATUS, DCODAT, B.PLNT, BILL_CUST, BILL_CUST_CLASS, SHIP_CUST_CLASS, BVCTRY CTRY, BVPRCD DEST, RTRIM(DCPO) DCPO, RTRIM(DCPROM) DCPROM, 
	DDORD#,FGRP, DCCURR, 
	ORD_TERMS, 
	DISCP, DISCDAYS, 
	CASE PAYDATE WHEN '' THEN PAYDAYS ELSE DAYS(PAYDATE) - DAYS(DCODAT) END NETDAYS,
	SUM(DDQTOI) DDQTOI,
	SUM(ORD_AMT_USD) ORD_AMT_USD, 
	SUM(DDQTOI/CASE COALESCE(FACTOR,0) WHEN 0 THEN 0 ELSE 1.0/FLOAT(FACTOR) END) PALLETS,
	SUM(DDQTOI*MAT*RATE) ORD_MATCOST_USD
	
FROM
	FANALYSIS.VW_FFORDB B
	LEFT OUTER JOIN LGDAT.CUST ON
		BVCUST = RTRIM(SUBSTR(SHIP_CUST,1,8))
	LEFT OUTER JOIN LGDAT.STKA A ON
		V6PART = DDPART AND
		V6PLNT = B.PLNT
	LEFT OUTER JOIN QGPL.FFICSTX X ON
		X.PART = V6PART AND
		X.PLNT = V6PLNT AND
		TRI = 'STD'
	LEFT OUTER JOIN FANALYSIS.VW_FFUNIT ON
		IHPART = V6PART AND
		IHUNT1 = V6UNTI AND
		IHUNT2 = 'PLT'
	LEFT OUTER JOIN FANALYSIS.VW_FFPLPR PL ON
		YAPLNT = B.PLNT
	LEFT OUTER JOIN FANALYSIS.VW_FFGLPD PD ON
		PL.COMP = PD.COMP AND
		SDAT <= DCODAT AND
		EDAT >= DCODAT
	LEFT OUTER JOIN FANALYSIS.FFCRET F ON
		FCUR = CURR AND
		TCUR = 'US' AND
		RTYP = 'ME' AND
		F.PERD = FSPR
WHERE
	ORD_PERD = '1511' AND
	CALC_STATUS <> 'CANCELED'
GROUP BY
	ORD_PERD, CALC_STATUS, DCODAT, B.PLNT, BILL_CUST, BILL_CUST_CLASS, SHIP_CUST_CLASS, BVCTRY, BVPRCD, RTRIM(DCPO), RTRIM(DCPROM), 
	DDORD#,FGRP, DCCURR, 
	ORD_TERMS, 
	DISCP, DISCDAYS, 
	CASE PAYDATE WHEN '' THEN PAYDAYS ELSE DAYS(PAYDATE) - DAYS(DCODAT) END 
FETCH FIRST 10 ROWS ONLY