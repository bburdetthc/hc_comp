
CREATE VIEW QGPL.VW_FFOPORD AS
SELECT
	SUBSTR(CHAR(DCMDAT),3,2)||SUBSTR(CHAR(DCMDAT),6,2) PROMPERD, 
	CASE 
		WHEN SUBSTR(CHAR(CURRENT_DATE),3,2)||SUBSTR(CHAR(CURRENT_DATE),6,2) = SUBSTR(CHAR(DCMDAT),3,2)||SUBSTR(CHAR(DCMDAT),6,2) THEN 'CURRENT_PER'
		WHEN SUBSTR(CHAR(CURRENT_DATE),3,2)||SUBSTR(CHAR(CURRENT_DATE),6,2) > SUBSTR(CHAR(DCMDAT),3,2)||SUBSTR(CHAR(DCMDAT),6,2) THEN 'PRIOR_PER'
		WHEN SUBSTR(CHAR(CURRENT_DATE),3,2)||SUBSTR(CHAR(CURRENT_DATE),6,2) < SUBSTR(CHAR(DCMDAT),3,2)||SUBSTR(CHAR(DCMDAT),6,2) THEN 'FUTURE_PER'
	END TIME_FRAME,
	DCSTAT, DDITST, DCBCUS||' - '||RTRIM(BVNAME) BILL_CUST, BVCLAS, BVCOMP REMIT_COMP, DCCURR, DCPLNT, DCSTKL, DDSTKL, SUBSTR(DCSTKL,1,3) PLNT, DDCRRS,
	DCPROM, DDORD#, DDITM#, RTRIM(DDPART)||' - '||RTRIM(COALESCE(AWDES1, AVDES1)) PART, DDGLC, 
	COALESCE(AWGLED, AVGLED) GLED,
	DIGITS(ZWSAL#) SALE_ACCT,
	AZGROP||' - '||RTRIM(BQ1TITL) FGRP,
	COALESCE(AWMAJG,AVMAJG)||' - '||RTRIM(BQDES) MAJG,
	COALESCE(AWMING, AVMING)||' - '||RTRIM(BRDES) MING,
	AVMAJS||' - '||SMJ.BSDES1 SMAJ,
	AVMINS||' - '||SMN.BSDES1 SMIN, 
	DDQTOI,DDQTBI, DDQTSI, DDUNIT, DDUNPR, DDTOTI, V6UNTI, 
	TOT TOTCOST , 
	COALESCE(TOT*(DDQTOI-DDQTSI)*CASE SUBSTR(DCSTKL,1,2) WHEN '11' THEN IS ELSE 1 END,0) COST_USD,
	DDTOTI/DDQTOI*(DDQTOI-DDQTSI)*CASE DCCURR WHEN 'CA' THEN IS ELSE 1 END SALES_USD
FROM
	LGDAT.OCRH
	INNER JOIN LGDAT.OCRI ON
		DDORD# = DCORD#
	INNER JOIN LGDAT.CUST ON
		BVCUST = DCBCUS
	LEFT OUTER JOIN LGDAT.STKA ON
		V6PART = DDPART AND
		V6PLNT = DCPLNT
	LEFT OUTER JOIN QGPL.FFICSTX C ON
		C.PART = DDPART AND
		C.PLNT = SUBSTR(DCSTKL,1,3) AND
		C.TRI = 'STD'
	LEFT OUTER JOIN LGDAT.CODE G ON
		G.A2 = 'EE' AND
		LTRIM(RTRIM(G.A9)) = DDGLC
	LEFT OUTER JOIN LGDAT.STKMM ON
		AVPART = DDPART
	LEFT OUTER JOIN LGDAT.STKMP ON
		AWPART = DDPART
	LEFT OUTER JOIN LGDAT.PLNT ON
		YAPLNT = SUBSTR(DCSTKL,1,3) 
	LEFT OUTER JOIN LGDAT.GLIE ON
		Y1PLNT = SUBSTR(DCSTKL,1,3) AND
		Y1GLEC = COALESCE(AVGLED, AWGLED)
	LEFT OUTER JOIN LGDAT.MAJG ON
		BQGRP = COALESCE(AWMAJG, AVMAJG)
	LEFT OUTER JOIN LGDAT.MMGP ON
		BRGRP = BQGRP AND
		BRMGRP = COALESCE(AVMING, AWMING)
	LEFT OUTER JOIN LGDAT.ARMASC ON
		ZWCOMP = BVCOMP AND
		ZWKEY1 = BVARCD AND
		ZWKEY2 = DDGLC
	LEFT OUTER JOIN LGDAT.MAST ON
		AZCOMP||DIGITS(AZGL#1)||DIGITS(AZGL#2) = DIGITS(ZWSAL#)
	LEFT OUTER JOIN LGDAT.FGRP ON
		BQ1GRP = AZGROP
	LEFT OUTER JOIN LGDAT.MMSL SMN ON
		SMN.BSMJCD = DDMAJS AND
		SMN.BSMNCD = DDMINS
	LEFT OUTER JOIN LGDAT.MMSL SMJ ON
		SMJ.BSMJCD = DDMAJS AND
		SMJ.BSMNCD = ''
	LEFT OUTER JOIN QGPL.FFFX XS ON
		XS.PERD = SUBSTR(CHAR(CURRENT_DATE),3,2)||SUBSTR(CHAR(CURRENT_DATE),6,2)

WHERE
	DCSTAT <> 'C' AND
	DDITST <> 'C' AND
	BVCLAS NOT IN ('INTC','INTR')

