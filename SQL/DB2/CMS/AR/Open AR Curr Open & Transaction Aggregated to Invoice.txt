SELECT
	IDAT, COMP, CUST, INV, SUM(DUE), PERD, PDAT
FROM
(
SELECT
	ASTRTP TP, CHAR(ASTDAT) AS IDAT, ASCOMP COMP, ASCUST CUST, LTRIM(RTRIM(ASINV#)) AS INV, ASDUAM DUE, DIGITS(ASFSYR)||DIGITS(ASFSPR) AS PERD, '' PDAT
FROM
	LGDAT.AROP AROP
	INNER JOIN LGDAT.CUST ON
		BVCUST = ASCUST
WHERE
	ASCOMP = '66' AND
	BVARCD = 'F' AND
	DIGITS(ASFSYR)||DIGITS(ASFSPR) <= '1402'

UNION ALL

SELECT
	LOTRTP TP,
	CHAR(LOIDAT) IDAT,
	LOCOMP COMP,
	LOCUST CUST,
	LOINV# INV,
	-LOAMT DUE,
	DIGITS(LOFSYR)||DIGITS(LOFSPR) AS PERD,
	CHAR(LOTDAT) PDAT
FROM
	LGDAT.ARTRN
	INNER JOIN LGDAT.CUST ON
		BVCUST = LOCUST
WHERE
	LOCOMP = '66' AND
	BVARCD = 'F' AND
	DIGITS(LOFSYR)||DIGITS(LOFSPR) > '1402'
) X
GROUP BY
	IDAT, COMP, CUST, INV, PERD, PDAT
