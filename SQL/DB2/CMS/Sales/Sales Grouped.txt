SELECT
	DIGITS(DHARYR)||DIGITS(DHARPR) PERD,
	DHCOMP, 
	DHCURR,
	BVCOMP, 
	BVCLAS,
	DIGLCD||' - '||RTRIM(A30) GLCODE, 
	DHINCR, 
	COALESCE(AWGLED, AVGLED) GLED,
	COALESCE(AWMAJG,AVMAJG)||' - '||RTRIM(BQDES) MAJG,
	COALESCE(AWMING, AVMING)||' - '||RTRIM(BRDES)  MING,
	HYPOLD HYPACCT, 
	DIGITS(ZWSAL#) CMSGL,
	SUBSTR(DIGITS(ZWSAL#),7,4) PRIME,
	COUNT(DILIN#) AS LINECOUNT, 
	SUM(COALESCE(CGSTCS, CHSTCS,Y0STCS,0)*DIQTSH*CASE DHINCR WHEN 'C' THEN -1 ELSE 1 END) CCTEX,
	SUM(DICTEX*CASE DHINCR WHEN 'C' THEN -1 ELSE 1 END) HCTEX,
	SUM(DIEXTN*CASE DHINCR WHEN 'C' THEN -1 ELSE 1 END) EXTN,
	SUM(DIEXT*CASE DHINCR WHEN 'C' THEN -1 ELSE 1 END) EXT
FROM
	LGDAT.OIH
	LEFT OUTER JOIN LGDAT.OID ON
		DIINV# = DHINV#
	LEFT OUTER JOIN LGDAT.CODE ON
		A2 = 'EE' AND
		LTRIM(RTRIM(A9)) = DIGLCD
	LEFT OUTER JOIN LGDAT.CUST ON
		BVCUST = DHBCS#
	LEFT OUTER JOIN LGDAT.STKA ON
		V6PART = DIPART AND
		V6PLNT = DHPLNT
	LEFT OUTER JOIN LGDAT.STKMM ON
		AVPART = DIPART
	LEFT OUTER JOIN LGDAT.STKMP ON
		AWPART = DIPART
	LEFT OUTER JOIN LGDAT.PLNT ON
		YAPLNT = DHPLNT
	LEFT OUTER JOIN LGDAT.GLIE ON
		Y1PLNT = DHPLNT AND
		Y1GLEC = COALESCE(AVGLED, AWGLED)
	LEFT OUTER JOIN LGDAT.MAJG ON
		BQGRP = COALESCE(AWMAJG, AVMAJG)
	LEFT OUTER JOIN LGDAT.MMGP ON
		BRGRP = BQGRP AND
		BRMGRP = COALESCE(AVMING, AWMING)
	LEFT OUTER JOIN LGDAT.ICSTM ON
		CGPART = DIPART AND
		CGPLNT = DHPLNT
	LEFT OUTER JOIN LGDAT.ICSTP ON
		CHPART = DIPART AND
		CHPLNT = DHPLNT
	LEFT OUTER JOIN LGDAT.ICSTR ON
		Y0PART = DIPART AND
		Y0PLNT = DHPLNT
	LEFT OUTER JOIN LGDAT.ARMASC ON
		ZWCOMP = BVCOMP AND
		ZWKEY1 = BVARCD AND
		ZWKEY2 = DIGLCD
	LEFT OUTER JOIN LGPGM.CMSTOHYP ON
		CMSGL = ZWSAL#

WHERE
	DHARYR = 14
GROUP BY
	DIGITS(DHARYR)||DIGITS(DHARPR),
	DHCOMP, 
	DHCURR,
	BVCOMP, 
	BVCLAS,
	DIGLCD||' - '||RTRIM(A30), 
	DHINCR, 
	COALESCE(AWGLED, AVGLED),
	COALESCE(AWMAJG,AVMAJG)||' - '||RTRIM(BQDES),
	COALESCE(AWMING, AVMING)||' - '||RTRIM(BRDES),
	HYPOLD, 
	DIGITS(ZWSAL#),
	SUBSTR(DIGITS(ZWSAL#),7,4)