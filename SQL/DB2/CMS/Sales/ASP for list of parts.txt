--DECLARE GLOBAL TEMPORARY TABLE PLIST (PART CHAR(20))

--INSERT INTO QTEMP.PLIST VALUES

--DECLARE GLOBAL TEMPORARY TABLE PPERD (PART CHAR(20), PERD CHAR(4))

/*
INSERT INTO QTEMP.PPERD 
SELECT 
	PART, MAX(DIGITS(DHARYR)||DIGITS(DHARPR))
FROM
	QTEMP.PLIST
	INNER JOIN LGDAT.OID ON
		DIPART = PART
	INNER JOIN LGDAT.OIH ON
		DHINV# = DIINV#
GROUP BY PART
*/

--DECLARE GLOBAL TEMPORARY TABLE MULT (NUM INT)

--INSERT INTO QTEMP.MULT VALUES (0),(1),(2),(3),(4),(5)

--DECLARE GLOBAL TEMPORARY TABLE PMPERD (PART CHAR(20), PERD CHAR(4))

/*
INSERT INTO QTEMP.PMPERD
SELECT
	PART,
	CASE SUBSTR(DIGITS(PERD-NUM),9,2)
		WHEN '00' THEN SUBSTR(DIGITS(PERD-NUM-1),7,2)||'12'
		WHEN '99' THEN SUBSTR(DIGITS(PERD-NUM),7,2)||'11'
		WHEN '98' THEN SUBSTR(DIGITS(PERD-NUM),7,2)||'10'
		WHEN '97' THEN SUBSTR(DIGITS(PERD-NUM),7,2)||'09'
		WHEN '96' THEN SUBSTR(DIGITS(PERD-NUM),7,2)||'08'
		ELSE SUBSTR(DIGITS(PERD-NUM),7,4)
	END
FROM
	QTEMP.PPERD
	CROSS JOIN QTEMP.MULT
*/


--DELETE FROM QGPL.PTINVHIST

/*
INSERT INTO QGPL.PTINVHIST
SELECT
	DHPLNT,
	DIGITS(DHARYR)||DIGITS(DHARPR),
	DIPART,	
	DIINV#, 
	DILIN#,
	DIQTSH,
	DIEXT,
	DHINCR,
	DIGLCD,
	BVCLAS
FROM
	QTEMP.PMPERD
	INNER JOIN LGDAT.OID ON
		DIPART = PART
	INNER JOIN LGDAT.OIH ON
		DIINV# = DHINV# AND
		DIGITS(DHARYR)||DIGITS(DHARPR) = PERD
	INNER JOIN LGDAT.CUST ON
		BVCUST = DHBCS#
*/