SELECT
	COALESCE(AVDPLT, AWDPLT) AS A_DPLT, DIGLCD, AORESC, AODEPT, SUM(DIEXT*CASE DHINCR WHEN 'C' THEN -1 ELSE 1 END)
FROM
	LGDAT.OIH
	LEFT OUTER JOIN LGDAT.OID ON
		DIINV# = DHINV#
	LEFT OUTER JOIN LGDAT.STKMM ON
		AVPART = DIPART
	LEFT OUTER JOIN LGDAT.STKMP ON
		AWPART = DIPART
	LEFT OUTER JOIN LGDAT.METHDR ON
		AOPART = DIPART AND
		AOPLNT = COALESCE(AVDPLT, AWDPLT)
WHERE
	DHARYR = 12
GROUP BY
	COALESCE(AVDPLT, AWDPLT) , DIGLCD, AORESC, AODEPT
		