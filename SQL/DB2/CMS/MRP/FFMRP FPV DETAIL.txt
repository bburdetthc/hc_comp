SELECT
	VERSION,
	BUILD, 
	M.*,
	MAJG, MING, GLEC, GLDC, 
	ERQTY*QTY QTYREQ, 
	ERQTYS*QTY SCRREQ, 
	CASE RUNTIME WHEN 0 THEN 0 ELSE (1/RUNTIME+CASE RUNSIZE WHEN 0 THEN 0 ELSE SETTIME/1000000 END)*ERQTY*QTY END MHRS, 
	CASE RUNTIME WHEN 0 THEN 0 ELSE (1/RUNTIME+CASE RUNSIZE WHEN 0 THEN 0 ELSE SETTIME/1000000 END)*ERQTYS*QTY END SMHRS,
	ORD_PERD, MREQ_PERD, SHP_PERD,
	(TOT+COALESCE(FPV,0))*(ERQTY+ERQTYS)*QTY*CASE WHEN SUBSTR(GLEC,1,1) <= '2' THEN 1 ELSE 0 END*CASE M.AOREPP WHEN 'N' THEN 0 ELSE 1 END FPV
FROM
	(
		SELECT
			VERSION, PLNT, PART, ORD_PERD, MREQ_PERD, SHP_PERD, SUM(QTY) QTY, SUM(VALUE) VALUE
		FROM
			FANALYSIS.FFFORD
		GROUP BY
			VERSION, PLNT, PART, ORD_PERD, MREQ_PERD, SHP_PERD
	) O
	LEFT OUTER JOIN FANALYSIS.FFMRP M ON
		O.PART = M.MAST AND
		O.PLNT = M.MPLT
	LEFT OUTER JOIN LGDAT.RESRE ON
		ABDEPT = M.DEP AND
		ABRESC = M.RESC
	LEFT OUTER JOIN LGDAT.MACGRP ON
		ADMACG = ABMACG
	LEFT OUTER JOIN QGPL.FFRGRP RG ON
		RG.DEPT = M.DEP AND
		RG.RESC = M.RESC
	LEFT OUTER JOIN FANALYSIS.VW_FFITEMM ON
		ITEM = M.PART
	LEFT OUTER JOIN
(
SELECT
	P.CLINE,	
	SUM(-M.ERQTY*C.TOT) FPV 
FROM
	FANALYSIS.FFMRP P
	LEFT OUTER JOIN FANALYSIS.FFMRP M ON
		M.PLINE = P.CLINE
	LEFT OUTER JOIN QGPL.FFICSTX C ON
		C.PART = M.PART AND
		C.PLNT = M.CPLNT AND
		C.TRI = 'STD'
	LEFT OUTER JOIN FANALYSIS.VW_FFSTKMX ON
		AVPART = M.PART
WHERE
	SUBSTR(AVGLED,1,1) <= '2' AND
	M.AOREPP <> 'N'
GROUP BY
	P.CLINE
) F ON
	F.CLINE = M.CLINE
	LEFT OUTER JOIN QGPL.FFICSTX C ON
		C.PART = M.PART AND
		C.PLNT = M.SPLNT AND
		C.TRI = 'STD'


WHERE
	MAST = 'XAL05000G18C600' AND ORD_PERD = '1601'

FETCH FIRST 100 ROWS ONLY