SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV ,
 	'JOURNAL ENTRY' AS CUSMOD,
 	DKADDD AS CUSKEY1,
 	'BATCH DESCR' AS CUSKEY1D,
 	DKREFD AS CUSKEY2,
 	'LINE DESCR' AS CUSKEY2D,
 	DKKEYN AS CUSKEY3,
 	'BATCH' AS CUSKEY3D,
 	DKREF# AS CUSKEY4,
 	'JOUNAL' AS CUSKEY4D,
 	'' AS CUSVEND,
 	DKBCUS AS CUSCUST, 
	DIGITS(DKRCID) AS RECID
FROM 
 	LGDAT.GTRAN GTRAN
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
WHERE
 	DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND
 	DKSRCE IN ('GJ','RJ')

UNION ALL

SELECT
 	DKSRCE||DKQUAL AS MODULE, 
 	DIGITS(DKBTC#) AS BATCH, 
 	DIGITS(DKFSYY)||DIGITS(DKFSPR),
 	CHAR(DKTDAT) AS TDATE, 
 	CHAR(DKPDAT) AS PDATE, 
 	DIGITS(DKACC#) AS ACCT, 
 	DKAMT AS AMT, 
 	DKPJNM AS PROJ, 
 	DKFUT4 AS USRN,
 	DKREV AS REV,
 	UPPER(LTRIM(RTRIM(DKREFD))) AS CUSMOD,
 	DKKEYN AS CUSKEY1, 
 	'VOUCHER' AS CUSKEY1D,
 	'' AS KEY2,
 	'' AS KEY2D,
 	'' AS KEY3,
 	'' AS KEY3D,
 	''AS KEY4,
 	'' AS KEY4D,
 	LTRIM(RTRIM(SUBSTR(DKADDD,7,25))) AS CUSVEND,
 	'' AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM
 	LGDAT.GLSBAP
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
WHERE
 	DKSRCE||DKQUAL = 'AP' AND
 	DKFSYR = 20 AND  DKFSYY = 'YY' AND  DKFSPR = 'PP'

UNION ALL

SELECT
 	DKSRCE||DKQUAL AS MODULE, 
 	DIGITS(DKBTC#) AS BATCH, 
 	DIGITS(DKFSYY)||DIGITS(DKFSPR),
 	CHAR(DKTDAT) AS TDATE, 
 	CHAR(DKPDAT) AS PDATE, 
	 DIGITS(DKACC#) AS ACCT, 
 	DKAMT AS AMT, 
 	DKPJNM AS PROJ, 
 	DKFUT4 AS USRN,
 	DKREV AS REV,
 	UPPER(DKREFD) AS CUSMOD,
 	DKKEYN AS CUSKEY1, 
 	'ITEM' AS CUSKEY1D,
 	'' AS KEY2,
	 '' AS KEY2D,
 	'' AS KEY3,
 	'' AS KEY3D,
 	''AS KEY4,
 	'' AS KEY4D,
 	'' AS CUSVEND,
 	'' AS CUSCUST, 
	DIGITS(DKRCID) AS RECID
FROM
 	LGDAT.GLSBAP
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
WHERE
 	DKSRCE||DKQUAL = 'APAC' AND
 	DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP'

UNIONA ALL

SELECT
 	DKSRCE||DKQUAL AS MODULE, 
 	DIGITS(DKBTC#) AS BATCH, 
 	DIGITS(DKFSYY)||DIGITS(DKFSPR) ,
 	CHAR(DKTDAT) AS TDATE, 
 	CHAR(DKPDAT) AS PDATE, 
 	DIGITS(DKACC#) AS ACCT, 
	ROUND(CASE 
  		WHEN ABS(DKAMT) = CHR.GROS-CHR.DISC THEN IDGROS - CASE CHQ.DISC WHEN 0 THEN 0 ELSE AVTDIS END
  		WHEN ABS(DKAMT) = CHR.GROS THEN IDGROS
  		WHEN ABS(DKAMT) = CHR.DISC THEN CASE CHQ.DISC WHEN 0 THEN 0 ELSE AVTDIS END
  		ELSE (ABS(DKAMT)/(CHR.GROS-CHR.DISC)*(IDGROS-CASE CHQ.DISC WHEN 0 THEN 0 ELSE AVTDIS END))
 	END*CASE 
		WHEN DKAMT <0 THEN -1 
		ELSE 1 
	END,2) AS AMT,
 	DKPJNM AS PROJ, 
 	DKFUT4 AS USRN,
 	DKREV AS REV,
 	'CHECK RUN' AS CUSMOD,
 	DKKEYN AS CUSKEY1, 
 	'CHECK TRANSACTION' AS CUSKEY1D, 
 	IGCHQ# AS KEY2, 
 	'CHECK NUMBER' AS CUSKEY2D, 
 	AVTVH# AS CUSKEY3,
 	'VOUCHER' AS CUSKEY3D,
 	IDINV# AS CUSKEY4,
 	'INVOICE' AS CUSKEY4D,
 	IGVEN# AS CUSVEND,
 	'' AS CUSCUST, DKRCID
FROM
 	LGDAT.GLSBAP
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
 	LEFT OUTER JOIN LGDAT.CHQR ON
  		IGTXR# = DKKEYN AND
  		IGFSYY = DKFSYY AND
  		IGFSPP = DKFSPR
 	LEFT OUTER JOIN LGDAT.AVTX ON
  		AVTCO# = IGCOM# AND
  		AVTCHQ = IGCHQ# AND
  		AVTCHB = IGBNK# AND AVTTYP = 4
 	LEFT OUTER JOIN LGDAT.VCHR ON
  		IDCOM# = IGCOM# AND
  		IDBNK# = IGBNK# AND
  		IDVCH# = AVTVH#
 	LEFT OUTER JOIN
 	(
  		SELECT
   			IGCOM# AS COMP, IGTXR# AS TXR, IGCHQ# AS CHQN, IGFSYY AS YY, IGFSPP AS PP, SUM(IGGROS) AS GROS, SUM(IGDISC) AS DISC
  		FROM
  			LGDAT.CHQR
  		WHERE
   			IGTXR# IN 
			(
				SELECT DISTINCT 
					DKKEYN 
				FROM 
					LGDAT.GLSBAP 
					INNER JOIN QTEMP.A ON
						ACCT = DKACC#
				WHERE 
					DKSRCE = 'AP' AND 
					DKQUAL = 'CQ' AND 
					DKQU	AL = 'CQ' AND 
					DKFSYR = 20 AND  
					DKFSYY = 'YY' AND 
					DKFSPR = 'PP'
			)
 	 	GROUP BY
   			IGCOM#, IGTXR#, IGCHQ#, IGFSYY, IGFSPP
 	) CHQ ON
  		CHQ.COMP = SUBSTR(DKACC#,1,2) AND
  		CHQ.TXR = DKKEYN AND
  		CHQ.YY = DKFSYY AND
  		CHQ.PP = DKFSPR AND
  		CHQN = IGCHQ#
 	LEFT OUTER JOIN
 	(
  		SELECT
   			IGCOM# AS COMP, IGTXR# AS TXR, IGFSYY AS YY, IGFSPP AS PP, SUM(IGGROS) AS GROS, SUM(IGDISC) AS DISC
 		FROM
  			LGDAT.CHQR
  		WHERE
   			IGTXR# IN
			(
				SELECT DISTINCT 
					DKKEYN 
				FROM 
					LGDAT.GLSBAP 
					INNER JOIN QTEMP.A ON
						ACCT = DKACC#
				WHERE 
					DKSRCE = 'AP' AND 
					DKQUAL = 'CQ' AND 
					DKQU	AL = 'CQ' AND 
					DKFSYR = 20 AND  
					DKFSYY = 'YY' AND 
					DKFSPR = 'PP'
			)
  		GROUP BY
   			IGCOM#, IGTXR#, IGFSYY, IGFSPP
 	) CHR ON
  		CHR.COMP = SUBSTR(DKACC#,1,2) AND
  		CHR.TXR = DKKEYN AND
  		CHR.YY = DKFSYY AND
  		CHR.PP = DKFSPR
WHERE
 	DKSRCE = 'AP' AND
 	DKQUAL = 'CQ' AND
 	DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP'

UNION ALL

SELECT
 	DKSRCE||DKQUAL AS MODULE, 
 	DIGITS(DKBTC#) AS BATCH, DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) AS TDATE, 
 	CHAR(DKPDAT) AS PDATE, 
 	DIGITS(DKACC#) AS ACCT, 
 	ROUND((ABS(DKAMT)/(IGGROS+IGDISC))*CASE WHEN DKAMT <0 THEN -1 ELSE 1 END*IDGROS,2) AS AMT, 
 	DKPJNM AS PROJ, 
 	DKFUT4 AS USRN,
 	DKREV AS REV,
 	UPPER(LTRIM(RTRIM(SUBSTR(DKREFD,1,9)))) AS CUSMOD,
 	IGTXR# AS CUSKEY1, 
 	'CHECK TRANSACTION' AS CUSKEY1D, 
 	IGCHQ# AS KEY2, 
 	'CHECK NUMBER' AS CUSKEY2D, 
 	DIGITS(AVTVH#) AS CUSKEY3,
 	'VOUCHER' AS CUSKEY3D,
 	IDINV# AS CUSKEY4,
 	'INVOICE' AS CUSKEY4D,
 	IGVEN# AS CUSVEND,
 	'' AS CUSCUST, 
	DIGITS(DKRCID) AS RECID
FROM
 	LGDAT.GLSBAP
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
 	LEFT OUTER JOIN LGDAT.CHQR ON
  		IGCHQ# = LTRIM(RTRIM(DKKEYN)) AND
  		IGCOM# = SUBSTR(DKACC#,1,2)
 	LEFT OUTER JOIN LGDAT.AVTX ON
  		AVTCO# = IGCOM# AND
  		AVTCHQ = IGCHQ# AND
  		AVTCHB = IGBNK# AND
  		AVTTYP = 4
 	LEFT OUTER JOIN LGDAT.VCHR ON
  		IDCOM# = IGCOM# AND
  		IDBNK# = IGBNK# AND
  		IDVCH# = AVTVH#
WHERE
 	DKSRCE||DKQUAL = 'APVC' AND
 	DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  	
	DKFSPR = 'PP'

UNION ALL

SELECT
 	DKSRCE||DKQUAL AS MODULE, 
 	DIGITS(DKBTC#) AS BATCH, 
 	DIGITS(DKFSYY)||DIGITS(DKFSPR),
 	CHAR(DKTDAT) AS TDATE, 
 	CHAR(DKPDAT) AS PDATE, 
 	DIGITS(DKACC#) AS ACCT, 
 	DKAMT AS AMT,
 	DKPJNM AS PROJ, 
 	DKFUT4 AS USRN,
 	DKREV AS REV,
 	'VOUCHER ENTRY' AS CUSMOD,
 	DKKEYN AS CUSKEY1, 
 	'VOUCHER NUMBER' AS CUSKEY1D, 
 	IDBNK# AS KEY2, 
 	'BANK' AS CUSKEY2D, 
 	'' AS CUSKEY3,
	 '' AS CUSKEY3D,
 	IDINV# AS CUSKEY4,
 	'INVOICE' AS CUSKEY4D,
 	IDVEN# AS CUSVEND,
 	'' AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM
 	LGDAT.GLSBAP
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
 	LEFT OUTER JOIN LGDAT.VCHR ON
  		IDCOM# = SUBSTR(DKACC#,1,2) AND
 		IDVCH# = DKKEYN AND
  		IDFISY = DKFSYY AND
  		IDFISP = DKFSPR
WHERE
 	DKSRCE = 'AP' AND
 	DKQUAL = 'VN' AND
 	DKFSYR = 20 AND
	DKFSYY = 'YY' AND
	DKFSPR = 'PP'

UNION ALL

SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV , 
 	UPPER(LTRIM(RTRIM(SUBSTR(DKREFD,1,14)))) AS CUSMOD,
 	DKREF# AS CUSKEY1,
 	'DESCR1' AS CUSKEY1D,
 	DKADDD AS CUSKEY2,
 	'DESCR2' AS CUSKEY2D,
 	DIGITS(DKFUT14) AS CUSKEY3,
 	'AR BATCH' AS CUSKEY3D,
 	''AS CUSKEY4,
 	''AS CUSKEY4D,
 	'' AS CUSVEND,
 	BL8CUST AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM 
	LGDAT.GLSBAR GLSBAR
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
 	LEFT OUTER JOIN LGDAT.AROPT AROPT ON
  		GLSBAR.DKFSPR = AROPT.BL8FSPR AND 
  		GLSBAR.DKFSYR = AROPT.BL8FSYR AND 
  		GLSBAR.DKFSYY = AROPT.BL8FSYY AND 
  		GLSBAR.DKACC# = AROPT.BL8ACC# AND 
  		GLSBAR.DKTDAT = AROPT.BL8TRDAT AND 
  		GLSBAR.DKKEYN = AROPT.BL8KEYN AND 
  		GLSBAR.DKREF# = AROPT.BL8REFB AND 
  		GLSBAR.DKREFD = AROPT.BL8REFD AND 
  		GLSBAR.DKSRCE = AROPT.BL8SRCE AND 
  		GLSBAR.DKQUAL = AROPT.BL8QUAL AND
  		GLSBAR.DKADDD = AROPT.BL8ADDD AND
  		GLSBAR.DKBTC#  = AROPT.BL8BTC# AND
  		GLSBAR.DKFUT14 = AROPT.BL8BTCH AND
  		GLSBAR.DKAMT = AROPT.BL8AMT 
WHERE
 	GLSBAR.DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND 
 	DKSRCE = 'AR' AND 
 	DKQUAL = ''

UNION ALL

SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV , 
	 'CREDIT MEMO' CUSMOD,
 	CASE SUBSTR(DKKEYN,1,1) WHEN 'D' THEN SUBSTR(DKKEYN,2,5) ELSE DKKEYN END AS CUSKEY1,
 	CASE SUBSTR(DKKEYN,1,1) WHEN 'D' THEN 'DEBIT NOTE-CCRH' ELSE 'INVOICE-OIH' END AS CUSKEY1,
 	DKADDD AS CUSKEY2,
 	'ORIG INVOICE' AS CUSKEY2D,
	 DKFUT14 AS CUSKEY3,
 	'AR BATCH' AS CUSKEY3D,
 	BL8REF AS CUSKEY4,
	 'DESCR1'AS CUSKEY4D,
 	'' AS CUSVEND,
 	BL8CUST AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM 
	LGDAT.GLSBAR GLSBAR 
 	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
 	LEFT OUTER JOIN LGDAT.AROPT AROPT ON
  		GLSBAR.DKFSPR = AROPT.BL8FSPR AND 
  		GLSBAR.DKFSYR = AROPT.BL8FSYR AND 
  		GLSBAR.DKFSYY = AROPT.BL8FSYY AND 
  		GLSBAR.DKACC# = AROPT.BL8ACC# AND 
  		GLSBAR.DKTDAT = AROPT.BL8TRDAT AND 
  		GLSBAR.DKKEYN = AROPT.BL8KEYN AND 
  		GLSBAR.DKREF# = AROPT.BL8REFB AND 
  		GLSBAR.DKREFD = AROPT.BL8REFD AND 
 		GLSBAR.DKSRCE = AROPT.BL8SRCE AND 
  		GLSBAR.DKQUAL = AROPT.BL8QUAL AND
  		GLSBAR.DKADDD = AROPT.BL8ADDD AND
 		GLSBAR.DKFUT14 = AROPT.BL8BTCH
WHERE
 	GLSBAR.DKFSYR = 20 AND 
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND 
 	DKSRCE = 'AR' AND 
 	DKQUAL = 'IN'

UNION ALL

SELECT DISTINCT
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV , 
 	UPPER(LTRIM(RTRIM(SUBSTR(DKREFD,1,14)))) AS CUSMOD,
 	CASE UPPER(LTRIM(RTRIM(SUBSTR(DKREFD,1,14))))
  		WHEN 'ADJUSTMENT' THEN CASE SUBSTR(DKKEYN,1,1) WHEN 'D' THEN SUBSTR(DKKEYN,2,5) ELSE DKKEYN END
  		WHEN 'CASH RECEIPINV' THEN CASE SUBSTR(DKREFD,16,1) WHEN 'D' THEN SUBSTR(DKREFD,17,5) ELSE SUBSTR(DKREFD,16,6) END
  		WHEN 'DISCOUNT' THEN CASE SUBSTR(DKKEYN,1,1) WHEN 'D' THEN SUBSTR(DKKEYN,2,5) ELSE DKKEYN END
  		WHEN 'MISC CASH ENTR' THEN DKADDD
  		ELSE ''
 	END AS CUSKEY1,
 	CASE UPPER(LTRIM(RTRIM(SUBSTR(DKREFD,1,14))))
  		WHEN 'ADJUSTMENT' THEN CASE SUBSTR(DKKEYN,1,1) WHEN 'D' THEN 'DEBIT MEMO-X' ELSE 'INVOICE-OIH' END
  		WHEN 'CASH RECEIPINV' THEN CASE SUBSTR(DKREFD,16,1) WHEN 'D' THEN 'DEBIT MEMO-X' ELSE 'INVOICE-OIH' END
  		WHEN 'DISCOUNT' THEN CASE SUBSTR(DKKEYN,1,1) WHEN 'D' THEN 'DEBIT MEMO-X' ELSE 'INVOICE-OIH' END
  		WHEN 'MISC CASH ENTR' THEN 'DESCRIPTION-X'
  		ELSE ''
 	END AS CUSKEY1D,
 	CASE UPPER(LTRIM(RTRIM(SUBSTR(DKREFD,1,14))))
  		WHEN 'CASH RECEIPINV' THEN DKKEYN
  		WHEN 'CASH RECEIPT'  THEN DKKEYN
  		ELSE ''
 	END AS CUSKEY2,
 	CASE UPPER(LTRIM(RTRIM(SUBSTR(DKREFD,1,14))))
  		WHEN 'CASH RECEIPINV' THEN 'CHEQUE-ARTRN'
  		WHEN 'CASH RECEIPT'  THEN 'CHEQUE-ARTRN'
  		ELSE ''
 	END AS CUSKEY2D,
 	DIGITS(DKFUT14) AS CUSKEY3,
 	'AR BATCH'AS CUSKEY3D,
	 ''AS CUSKEY4,
	 ''AS CUSKEY4D,
	 ''AS CUSVEND,
 	CASE DKBCUS WHEN '' THEN BL8CUST ELSE DKBCUS END AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM 
 	LGDAT.GLSBAR GLSBAR
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
 	LEFT OUTER JOIN LGDAT.AROPT AROPT ON
 		 GLSBAR.DKFSPR = AROPT.BL8FSPR AND 
  		GLSBAR.DKFSYR = AROPT.BL8FSYR AND 
  		GLSBAR.DKFSYY = AROPT.BL8FSYY AND 
  		GLSBAR.DKACC# = AROPT.BL8ACC# AND 
  		GLSBAR.DKTDAT = AROPT.BL8TRDAT AND 
  		GLSBAR.DKKEYN = AROPT.BL8KEYN AND 
  		GLSBAR.DKREF# = AROPT.BL8REFB AND 
  		GLSBAR.DKREFD = AROPT.BL8REFD AND 
  		GLSBAR.DKSRCE = AROPT.BL8SRCE AND 
 		 GLSBAR.DKQUAL = AROPT.BL8QUAL AND
  		GLSBAR.DKAMT = AROPT.BL8AMT
WHERE
 	GLSBAR.DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND 
 	DKSRCE = 'AR' AND 
 	DKQUAL = 'RC'

UNION ALL

SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
	 CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV , 
 	LTRIM(RTRIM(UPPER(SUBSTR(DKADDD,1,4)))) AS CUSMOD,
 	DKPART AS CUSKEY1,
 	'PART' AS CUSKEY1D,
 	LTRIM(RTRIM(SUBSTR(DKADDD,13,14))) AS CUSKEY2,
	 'QTY' AS CUSKEY2D,
 	LTRIM(RTRIM(SUBSTR(DKADDD,28,2))) AS CUSKEY3,
	 'UOM' AS CUSKEY3D,
	 '' AS CUSKEY4,
	 ''AS CUSKEY4D,
 	'' AS CUSVEND,
 	'' AS CUSCUST, DIGITS(DKRCID) AS RECID

FROM 
 	LGDAT.GLSBIV GLSBIV
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
WHERE
 	DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND
 	DKSRCE = 'IC' AND 
 	DKQUAL = ''

UNION ALL

SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV , 
	 LTRIM(RTRIM(UPPER(SUBSTR(DKADDD,1,14)))) AS CUSMOD,
 	DKKEYN AS CUSKEY1,
 	'INVOICE' AS CUSKEY1D,
 	DKFUT9 AS CUSKEY2,
 	'INVOICE LINE' AS CUSKEY2D,
 	DHPLNT AS CUSKEY3,
 	'SHIP PLNT' AS CUSKEY3D,
 	'' AS CUSKEY4,
	 '' AS CUSKEY4D,
 	'' AS CUSVEND,
 	DHBCS# AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM 
 	LGDAT.GLSBIV GLSBIV
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
 	LEFT OUTER JOIN LGDAT.OIH ON
  		DHINV# = DKKEYN
WHERE
 	DKFSYR = 20 AND 
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND
 	DKSRCE = 'IC' AND 
 	DKQUAL = 'IN'

UNION ALL

SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV , 
 	LTRIM(RTRIM(UPPER(SUBSTR(DKADDD,1,4)))) AS CUSMOD,
 	DKPART AS CUSKEY1,
 	'PART' AS CUSKEY1D,
	 LTRIM(RTRIM(SUBSTR(DKADDD,13,14))) AS CUSKEY2,
 	'QTY' AS CUSKEY2D,
 	LTRIM(RTRIM(SUBSTR(DKADDD,28,2))) AS CUSKEY3,
 	'UOM' AS CUSKEY3D,
 	'' AS CUSKEY4,
 	''AS CUSKEY4D,
	 '' AS CUSVEND,
 	'' AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM 
 	LGDAT.GLSBIV GLSBIV
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
WHERE
 	DKFSYR = 20 AND  	
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND
 	DKSRCE = 'IC' AND 
 	DKQUAL = 'IT'

UNION ALL

SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV , 
 	'GOODS RECEIPT' AS CUSMOD,
 	DKKEYN AS CUSKEY1,
 	'REC LOG' AS CUSKEY1D,
 	DKPART AS CUSKEY2,
 	'PART' AS CUSTKEY2D,
 	'' AS CUSKEY3,
 	''AS CUSKEY3D,
	 '' AS CUSKEY4,
 	'' AS CUSKEY4D,
 	'' AS CUSVEND,
 	'' AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM 
 	LGDAT.GLSBIV GLSBIV
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
WHERE
 	DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND
 	DKSRCE = 'IC' AND 
 	DKQUAL = 'RL'

UNION ALL

SELECT 
 	DKSRCE||DKQUAL AS MODULE, 
  	DIGITS(DKBTC#) AS BATCH, 
  	DIGITS(DKFSYY)||DIGITS(DKFSPR),
  	CHAR(DKTDAT) AS TDATE, 
  	CHAR(DKPDAT) AS PDATE, 
  	DIGITS(DKACC#) AS ACCT, 
  	DKAMT AS AMT, 
  	DKPJNM AS PROJ, 
  	DKFUT4 AS USRN,
  	DKREV AS REV,
 	SUBSTR(DKADDD,1,12), DKKEYN, 
 	'RAN DOC NUM AND ITM',   
 	INRAN#, 
 	'RAN', 
 	INCRD#||' - '||INITM#, 
 	'CREDIT AND ITEM' , 
 	DIINV#, 
 	'CREDIT INVOICE', 
 	'',
 	INCUST,
 	DKRCID
FROM
 	LGDAT.GLSBIV
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
 	LEFT OUTER JOIN LGDAT.RANS ON
  		INRNDR = SUBSTR(DKKEYN,1,LOCATE('/',DKKEYN)-1) AND
  		INRNDI = SUBSTR(DKKEYN,LOCATE('/',DKKEYN)+1,1)
 	LEFT OUTER JOIN LGDAT.OID ON
  		DIORD# = INCRD# AND
 		 DIITM# = INITM#
WHERE
 	DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND
 	DKSRCE = 'IC' AND
 	DKQUAL = 'RT'

UNION ALL

SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV , 
 	'GOODS RECEIPT' AS CUSMOD,
 	DKKEYN AS CUSKEY1,
 	'RETURN TO VENDOR' AS CUSKEY1D,
 	DKPART AS CUSKEY2,
 	'PART' AS CUSKEY2D,
 	'' AS CUSKEY3,
 	''AS CUSKEY3D,
 	'' AS CUSKEY4,
 	'' AS CUSKEY4D,
 	'' AS CUSVEND,
 	'' AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM 
 	LGDAT.GLSBIV GLSBIV
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
WHERE
 	DKFSYR = 20 AND  
	DKFSYY = 'YY' AND 
	DKFSPR = 'PP' AND
 	DKSRCE = 'IC' AND 
 	DKQUAL = 'VR'

UNION ALL

SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV , 
 	UPPER(LTRIM(RTRIM(SUBSTR(DKREFD,1,14)))) AS CUSMOD,
 	DKKEYN AS CUSKEY1,
 	'INVOICE' AS CUSKEY1D,
 	DKFUT9 AS CUSKEY2,
 	'INVOICE LINE' AS CUSKEY2D, 
 	DHPLNT AS CUSKEY3,
 	'INVOICE PLANT' AS CUSKEY3D,
	 DHINCR AS CUSKEY4,
 	'INC/CRD' AS CUSKEY4D,
 	''AS CUSVEND,
 	DHBCS# AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM 
 	LGDAT.GLSBAR GLSBAR
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
 	LEFT OUTER JOIN LGDAT.OIH ON
  		DHINV# = DKKEYN
WHERE
 	GLSBAR.DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND 
 	DKSRCE = 'OE' AND 
 	DKQUAL = 'IN'

UNION ALL

SELECT 
 	DKSRCE||DKQUAL , 
 	DIGITS(DKBTC#) , 
 	DIGITS(DKFSYY)||DIGITS(DKFSPR) AS PERD,
 	CHAR(DKTDAT) , 
 	CHAR(DKPDAT) , 
 	DIGITS(DKACC#) , 
 	DKAMT , 
 	DKPJNM , 
 	DKFUT4 ,
 	DKREV ,
	 'PRODUCTION REPORTING' AS CUSMOD,
 	DKKEYN AS CUSKEY1,
 	'WORK ORDER' AS CUSKEY1D,
 	DKPART AS CUSKEY2,
 	'PARENT PART' AS CUSKEY2D,
 	UPPER(CASE WHEN SUBSTR(DKREFD,1,7) IN ('COMPLET','CP- PO#','WIP ADJ','VOID CO','REV WIP') THEN SUBSTR(DKREFD,1,7) ELSE SUBSTR(DKADDD,1,24) END) AS CUSKEY3,
 	'ACTION' AS CUSKEY3D,
 	'' AS CUSKEY4,
 	'' AS CUSKEY4D,
	 ''AS CUSVEND,
 	'' AS CUSCUST, DIGITS(DKRCID) AS RECID
FROM 
 	LGDAT.GLSBIV GLSBIV
	INNER JOIN QTEMP.A ON
		ACCT = DKACC#
WHERE
 	DKFSYR = 20 AND  
	DKFSYY = 'YY' AND  
	DKFSPR = 'PP' AND
 	DKSRCE = 'PD' AND 
 	DKQUAL = 'WO'
