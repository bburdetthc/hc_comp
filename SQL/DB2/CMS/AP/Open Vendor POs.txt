SELECT
	KBPO#, KBITYP, CHAR(KAODAT) KAODAT, KAOVND||' - '||RTRIM(KAOVNM) VENDOR, KBCRCM, KAOSTS, KBISTS, XLSTAT, 
	SUM(KBQTYO) KBQTYO, SUM(KBQTYR) KBQTYR, 
	SUM(KBQTYO-KBQTYR) QTYOPEN, 
	SUM(KBEXTN) KBEXTN, 
	SUM(KBQTYO-KBQTYR)/SUM(KBQTYO)*SUM(KBEXTN) AMTOPEN
FROM	
	LGDAT.POH
	INNER JOIN LGDAT.POI ON
		KAPO# = KBPO#
	LEFT OUTER JOIN LGDAT.PARQ ON
		XLPO# = KAPO#
WHERE
	KBISTS <> 'C' AND
	XLSTAT = 'C'
GROUP BY
	KBPO#, KBITYP, CHAR(KAODAT), KAOVND||' - '||RTRIM(KAOVNM), KAOSTS, KBCRCM, KBISTS, XLSTAT
HAVING
	SUM(KBQTYO-KBQTYR) <> 0 and
	SUM(KBQTYO-KBQTYR)/SUM(KBQTYO)*SUM(KBEXTN) >= 100000
FETCH FIRST 100 ROWS ONLY
