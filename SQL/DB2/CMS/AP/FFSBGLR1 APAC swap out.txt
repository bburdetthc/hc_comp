
SELECT 
	MODULE, BATCH, PERD, TDATE, PDATE,
	KRCOM#||DIGITS(D07GLAC) ACCT,D07AMT*CASE SUBSTR(CUSMOD,1,3) WHEN 'REV' THEN -1 ELSE 1 END AMT,
	USRN, REV, KBPRJ#, CUSMOD, 
	DIGITS(KRPO#)||DIGITS(KRPOI#)||' - '||RTRIM(KRDESC) CUSKEY1,
	'PO-ITEM-DESCR' CUSKEY1D,
	KRPT# CUSKEY2,
	'PART' CUSKEY2D,
	D07RKEY,
	'MASTER RECEIPT KEY' CUSKEY3D,
	KRQREC CUSKEY4,
	'QTY' CUSKEY4D,
	KRVEN# CUSVEND, '' CUSCUST, DIGITS(D07TXN) RECID
FROM 
	(
	SELECT DISTINCT
		MODULE, BATCH, PERD, TDATE, PDATE, SUBSTR(ACCT,1,2) COMP, USRN, REV, CUSMOD, SUBSTR(TDATE,3,2)||SUBSTR(TDATE,6,2) RPERD
	FROM 
		QGPL.FFSBGLR1 
	WHERE 
		PERD = '1502' AND 
		MODULE = 'APAC'
	) X
	INNER JOIN QGPL.FFPORCAG G ON
		G.D07FSPR = '20'||X.RPERD
	INNER JOIN QGPL.FFPORCAP C ON
		KRRKEY = D07RKEY AND
		FISC = SUBSTR(D07FSPR,3,4) AND
		KRCOM# = X.COMP
	INNER JOIN LGDAT.POI ON
		KBPO# = KRPO# AND
		KBITM# = KRPOI#
FETCH FIRST 100 ROWS ONLY
