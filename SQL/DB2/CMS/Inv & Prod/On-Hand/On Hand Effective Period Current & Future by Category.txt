SELECT
	YACOMP||DIGITS(Y1INVA) ACCT, 
	SUBSTR(YACOMP||DIGITS(Y1INVA),7,4) PRIME,
	BYPLNT, 
	BYPART,
	COALESCE(AWGLDC, AVGLCD) GLCD,
	COALESCE(AWGLED, AVGLED) GLED,
	COALESCE(AWMAJG,AVMAJG)||' - '||RTRIM(BQDES) MAJG,
	COALESCE(AWMING, AVMING)||' - '||RTRIM(BRDES)  MING,
	V6STAT, V6RPLN,
	SUM(QTOH) QTOH,
	SUM(COALESCE(JHTOTN, CGSTCS, CHSTCS, Y0STCS)*QTOH) AS CURSTD,
	SUM(COALESCE(JHMATN, CGMATS, CHSTCS, Y0SMAT)*QTOH) AS CURMAT, 
	SUM(COALESCE(JHLABN, CGLABS, Y0SLAB, 0)*QTOH) AS CURLAB, 
	SUM(COALESCE(JHBRFN, CGBRFS, Y0SFBR, 0)*QTOH) AS CURFIX, 
	SUM(COALESCE(JHBRVN, CGBRVS, Y0SVBR, 0)*QTOH) AS CURVAR, 
	SUM(COALESCE(JHOTHN, CGSTOC, Y0SOTC, 0)*QTOH) AS CUROTH,
	SUM(COALESCE(JHCRCN, Y0SOC, CHSCC, 0)*QTOH) CURCUR,
	SUM(COALESCE(JHSHCN+JHAVDN+JHAV1N+JHAV2N,CHSFC+CHSDC+CHS1C+CHS2C+CHSDWC, 0)*QTOH) AS CURSHP,
	SUM(COALESCE(CNSTCS, COSTCS, Y3STCS)*QTOH) AS FUTSTD,
	SUM(COALESCE(CNMATS, COSTCS, Y3SMAT)*QTOH) AS FUTMAT, 
	SUM(COALESCE(CNLABS, Y3SLAB, 0)*QTOH) AS FUTLAB, 
	SUM(COALESCE(CNBRFS, Y3SFBR, 0)*QTOH) AS FUTFIX, 
	SUM(COALESCE(CNBRVS, Y3SVBR, 0)*QTOH) AS FUTVAR, 
	SUM(COALESCE(CNSTOC, Y3SOTC, 0)*QTOH) AS FUTOTH,
	SUM(COALESCE(Y3SOC, COSCC, 0)*QTOH) FUTCUR,
	SUM(COALESCE(COSFC+COSDC+COS1C+COS2C, 0)*QTOH) AS FUTSHP
FROM
(
SELECT
	BYPLNT, BYPART,
	-SUM(BYQTY*CASE BYACTN WHEN 'I' THEN -1 ELSE 1 END) QTOH
FROM
	LGDAT.STKT
WHERE
	BYFSYY = 2014 AND
	BYFSPR >= 7
GROUP BY
	BYPLNT, BYPART

UNION ALL

SELECT
	BXPLNT BYPLNT,
	BXPART BYPART,
	SUM(BXQTOH) QTOH
FROM
	LGDAT.STKB
WHERE
	BXPART <> '' AND
	BXQTOH<> 0
GROUP BY
	BXPLNT, BXPART
) X

LEFT OUTER JOIN LGDAT.ICSTM ON
	CGPART = BYPART AND
	CGPLNT = BYPLNT
LEFT OUTER JOIN LGDAT.ICSTP ON
	CHPART = BYPART AND
	CHPLNT = BYPLNT
LEFT OUTER JOIN LGDAT.ICSTR ON
	Y0PART = BYPART AND
	Y0PLNT = BYPLNT
LEFT OUTER JOIN QGPL.FFCOSTEFFD ON
	PART = BYPART AND
	PLNT = BYPLNT AND
	FDT < '2014-07-01' AND
	TDT > '2014-07-01'
LEFT OUTER JOIN LGDAT.ICSTT ON
	JHPART = PART AND
	JHPLNT = PLNT AND
	JHRCID = FRI
LEFT OUTER JOIN LGDAT.FTCSTM ON
	CNPART = BYPART AND
	CNPLNT = BYPLNT
LEFT OUTER JOIN LGDAT.FTCSTP ON
	COPART = BYPART AND
	COPLNT = BYPLNT
LEFT OUTER JOIN LGDAT.FTCSTR ON
	Y3PART = BYPART AND
	Y3PLNT = BYPLNT
LEFT OUTER JOIN LGDAT.STKA ON
	V6PART = BYPART AND
	V6PLNT = BYPLNT
LEFT OUTER JOIN LGDAT.STKMM ON
	AVPART = BYPART
LEFT OUTER JOIN LGDAT.STKMP ON
	AWPART = BYPART
LEFT OUTER JOIN LGDAT.PLNT ON
	YAPLNT = BYPLNT
LEFT OUTER JOIN LGDAT.GLIE ON
	Y1PLNT = BYPLNT AND
	Y1GLEC = COALESCE(AVGLED, AWGLED)
LEFT OUTER JOIN LGDAT.MAJG ON
	BQGRP = COALESCE(AWMAJG, AVMAJG)
LEFT OUTER JOIN LGDAT.MMGP ON
	BRGRP = BQGRP AND
	BRMGRP = COALESCE(AVMING, AWMING)
GROUP BY
	YACOMP||DIGITS(Y1INVA),
	SUBSTR(YACOMP||DIGITS(Y1INVA),7,4),
	BYPLNT, BYPART, 
	COALESCE(AWGLDC, AVGLCD),
	COALESCE(AWGLED, AVGLED),
	COALESCE(AWMAJG,AVMAJG)||' - '||RTRIM(BQDES),
	COALESCE(AWMING, AVMING)||' - '||RTRIM(BRDES),
	V6STAT, V6RPLN