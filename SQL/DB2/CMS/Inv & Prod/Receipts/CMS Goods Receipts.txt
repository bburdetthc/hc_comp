SELECT DISTINCt 
	X.*, DKFSYR||DIGITS(DKFSYY)||DIGITS(DKFSPR) AS INVPER 
FROM 
	( 
	SELECT 
		JSRDAT, JSRLG#, DIGITS(JSRLGI) AS JSRLGI, JSPO#, JSLIN#, JSPT#, 
		COALESCE(AWMING, AVMING)||'-'||MMGP.BRDES AS MING, 
		JSPLNT, JSQTYR, 
		IFNULL( IHCNV1,1)/IFNULL(IHCNV2,1) AS UOMC, 
		COALESCE(CGSTCS, CHSTCS, Y0STCS)*JSQTYR AS STCS, 
		KBUPRC*JSQTYR*IFNULL( IHCNV1,1)/IFNULL(IHCNV2,1) AS POPRICE, 
		KBUPRC*JSQTYR*IFNULL( IHCNV1,1)/IFNULL(IHCNV2,1)-COALESCE(CGSTCS, CHSTCS, Y0STCS)*JSQTYR AS PPV, 
		KBGL#, Y1PRVR, 
		COALESCE(AWGLED, AVGLED) AS GLED, 
		KAOVND, KAOVNM, KAPLNT, LBVCH#, LBCOM#, 
		'20'|| V.LBFSYY||DIGITS(V.LBFSPP) AS VCHPER 
	FROM 
		LGDAT.PORCH R 
		LEFT OUTER JOIN LGDAT.POI PO ON 
			PO.KBPO# = JSPO# AND 
			PO.KBITM# = JSLIN# 
		LEFT OUTER JOIN LGDAT.POH ON 
			KAPO# = JSPO# 
		LEFT OUTER JOIN LGDAT.POMVAR V ON 
			V.LBRLG# = R.JSRLG# AND 
			V.LBPO# = R.JSPO# AND 
			V.LBPOI# = R.JSLIN# 
		LEFT OUTER JOIN LGDAT.ICSTP P ON 
			P.CHPART = R.JSPT# AND 
			P.CHPLNT = R.JSPLNT 
		LEFT OUTER JOIN LGDAT.ICSTM M ON 
			M.CGPART = R.JSPT# AND 
			M.CGPLNT = R.JSPLNT 
		LEFT OUTER JOIN LGDAT.ICSTR T ON 
			T.Y0PART = R.JSPT# AND 
			T.Y0PLNT = R.JSPLNT 
		LEFT OUTER JOIN LGDAT.STKMP SP ON 
			SP.AWPART = R.JSPT# 
		LEFT OUTER JOIN LGDAT.STKMM SM ON 
			SM.AVPART = R.JSPT# 
		LEFT OUTER JOIN LGDAT.PUNIT PUNIT ON 
			COALESCE(AVUNTI, AWUNTI) = PUNIT.IHUNT2 AND 
			KBPUNT = PUNIT.IHUNT1 AND 
			IHPART = '&&GLOBAL' 
		LEFT OUTER JOIN LGDAT.GLIE GLIE ON 
			Y1PLNT = JSPLNT AND 
			Y1GLEC = COALESCE(AWGLED, AVGLED) 
		LEFT OUTER JOIN LGDAT.MMGP MMGP ON 
			BRMGRP = COALESCE(AWMING, AVMING) AND 
			BRGRP = COALESCE(AWMAJG, AVMAJG) 
	WHERE 
		R.JSRDAT >= '2013-01-01' AND 
		R.JSRDAT < '2013-08-01' AND 
		(V.LBFSYY IS NULL OR V.LBFSYY||DIGITS(V.LBFSPP) >= 1301) 
	) X 
	LEFT OUTER JOIN LGDAT.GLSBIV I ON 
		DKKEYN = ' 000'||JSRLG# AND 
		DKSRCE = 'IC' AND 
		DKQUAL = 'RL' 
WHERE 
	DKFSPR IS NULL OR DKFSYR||DKFSYY||DIGITS(DKFSPR) <= 201307
fetch first 10 rows only
