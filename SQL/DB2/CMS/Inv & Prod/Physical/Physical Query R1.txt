SELECT
	WZBTCH, V6PLNT, MOD, WZSER#, WZSTKL, WZBIN#, X.PART, QTY, HTUNIT, V6UNTI, 
	COALESCE(GC.MFACT,GPU.MFACT) MFACT, 
	COALESCE(CHSTCS, CGSTCS, Y0STCS) STCS,
	COALESCE(CHSTCS, CGSTCS, Y0STCS)* COALESCE(GC.MFACT,GPU.MFACT)*QTY EXTCOST
FROM
	(
	SELECT 
		WZBTCH, V6PLNT, 'SER' MOD,WZSER#,WZSTKL, WZBIN#, COALESCE(HTPART, WZPART) PART, HTQTY QTY, HTUNIT HTUNIT, V6UNTI
	FROM 
		LGDAT.PHYS
		INNER JOIN LGDAT.SERI ON 
			WZSER#=HTMSTN 
		LEFT OUTER JOIN LGDAT.STKA ON
			V6PART = HTPART AND
			V6PLNT = SUBSTR(WZSTKL,1,3)
	WHERE 
		WZSTKL LIKE '152%'

	UNION ALL

	SELECT 
		WZBTCH, V6PLNT, 'PHY' MOD,WZSER#,WZSTKL, WZBIN#, WZPART PART, WZCQTY QTY,WZUNIT HTUNIT, V6UNTI                                                
	FROM 
		LGDAT.PHYS
		LEFT OUTER JOIN LGDAT.STKA ON
			V6PART = WZPART AND
			V6PLNT = SUBSTR(WZSTKL,1,3)
	WHERE 
		SUBSTR(WZSTKL,1,3) = '152' AND 
		WZPART <> ''

	UNION ALL

	SELECT 
		0 WZBTCH, V6PLNT, 'QOH' MOD, 0 WZSER#,LQstkl WZSTKL, LQbin# WZBIN#, LQPART PART, LQQTYH QTY, LQUNIT HTUNIT, V6UNTI                                               
	FROM 
		LGDAT.BINB
		LEFT OUTER JOIN LGDAT.STKA ON
			V6PART = LQPART AND
			V6PLNT = SUBSTR(LQSTKL,1,3)
	WHERE 
		LQSTKL LIKE '152%'
	) X
	LEFT OUTER JOIN QGPL.FFUCNV GC ON
		GC.FUNIT = HTUNIT AND
		GC.TUNIT = V6UNTI
	LEFT OUTER JOIN
		(
		SELECT
			IHPART PART,TUNIT FUNIT, IHUNT2 TUNIT, MFACT*IHCNV2/IHCNV1 MFACT
		FROM 
			LGDAT.PUNIT
			INNER JOIN QGPL.FFUCNV GD ON
				GD.FUNIT = IHUNT1
		UNION 	ALL

		SELECT
			IHPART PART,TUNIT FUNIT, IHUNT1 TUNIT, MFACT*IHCNV1/IHCNV2 MFACT
		FROM 
			LGDAT.PUNIT
			INNER JOIN QGPL.FFUCNV GD ON
				GD.FUNIT = IHUNT2
		) GPU ON
			X.PART = GPU.PART AND
			HTUNIT = GPU.FUNIT AND
			V6UNTI = GPU.TUNIT
		LEFT OUTER JOIN LGDAT.ICSTP ON
			CHPART = X.PART AND
			CHPLNT = V6PLNT
		LEFT OUTER JOIN LGDAT.ICSTM ON
			CGPART = X.PART AND
			CGPLNT = V6PLNT
		LEFT OUTER JOIN LGDAT.ICSTR ON
			Y0PART = X.PART AND
			Y0PLNT = V6PLNT
WHERE
	X.PART = 'RZ.JGAR1F04C001'