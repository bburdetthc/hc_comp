SELECT
	PERD, RTYPE, NWPLNT, ADEPT, ARESC, STAT, RPLN, SDEPT, SRESC, RRATE, 
	SUM(RTIME) RTIME,
	CODE
FROM
(
-----------------------------DOWNTIME--------------------------------------------
SELECT
	NWFSYY||DIGITS(NWFSPP) PERD, 'DOWN' RTYPE, NWPLNT, NXDEPT ADEPT, NXRESC ARESC, '' STAT, '' RPLN, '' SDEPT, '' SRESC, 
	0 RRATE, 
	SUM(NXTIME) RTIME,
	RTRIM(NXINDC)||' - '||RTRIM(AFDES1) CODE
FROM
	LGDAT.RPRH 
	INNER JOIN LGDAT.RPRD ON
		NWBTID = NXBTID
	LEFT OUTER JOIN LGDAT.INDLBR ON
		AFCODE = NXINDC
WHERE
	NWFSYY = 14
GROUP BY
	NWFSYY||DIGITS(NWFSPP), NWPLNT, NXDEPT, NXRESC,RTRIM(NXINDC)||' - '||RTRIM(AFDES1)

UNION ALL

--------------------------------RUN TIME----------------------------------------
SELECT
	NWFSYY||DIGITS(NWFSPP) PERD, 'RUN' RTYPE, NWPLNT, OADEPT ADEPT, OARESC ARESC, V6STAT STAT, V6RPLN RPLN, AODEPT SDEPT, AORESC SRESC,
	CASE ABVBRD WHEN 0 THEN IFNULL(AAVBRD,0) ELSE IFNULL(ABVBRD,0) END+CASE ABBRDR WHEN 0 THEN IFNULL(AABRDR,0) ELSE IFNULL(ABBRDR,0) END RRATE,
	SUM(OATIME) RTIME, 'RUN' CODE
FROM
	LGDAT.RPRR
	INNER JOIN LGDAT.RPRH ON
		NWBTID = OABTID
	LEFT OUTER JOIN LGDAT.METHDR ON
		AOPART = OAPART AND
		AOPLNT = NWPLNT AND
		AOSEQ# = OASEQ#
	LEFT OUTER JOIN LGDAT.PUNIT C1 ON
  		C1.IHPART = OAPART AND
   		C1.IHUNT2 = OAUNIT AND
   		C1.IHUNT1 = AOUNIT
  	LEFT OUTER JOIN LGDAT.PUNIT C2 ON
   		C2.IHPART = OAPART AND
   		C2.IHUNT1 = OAUNIT AND
   		C2.IHUNT2 = AOUNIT
	LEFT OUTER JOIN LGDAT.RESRE ON
   		ABDEPT = AODEPT AND
   		ABRESC = AORESC
  	LEFT OUTER JOIN LGDAT.DEPTS ON
   		ABDEPT = AADEPT
	LEFT OUTER JOIN LGDAT.STKA ON
		V6PART = OAPART AND
		V6PLNT = NWPLNT
WHERE
	NWFSYY = 14
GROUP BY
	NWFSYY||DIGITS(NWFSPP), NWPLNT, OADEPT, OARESC, AORESC, AODEPT,V6STAT, V6RPLN, 
	CASE ABVBRD WHEN 0 THEN IFNULL(AAVBRD,0) ELSE IFNULL(ABVBRD,0) END+CASE ABBRDR WHEN 0 THEN IFNULL(AABRDR,0) ELSE IFNULL(ABBRDR,0) END
UNION ALL

-------------------------------------EARNED HOURS------------------------------------------------
SELECT
	NWFSYY||DIGITS(NWFSPP) PERD, 'EARNED' RTYPE, NWPLNT, OADEPT ADEPT, OARESC ARESC, V6STAT STAT, V6RPLN RPLN, AODEPT SDEPT, AORESC SRESC,
	CASE ABVBRD WHEN 0 THEN IFNULL(AAVBRD,0) ELSE IFNULL(ABVBRD,0) END+CASE ABBRDR WHEN 0 THEN IFNULL(AABRDR,0) ELSE IFNULL(ABBRDR,0) END RRATE,
	SUM((OAQTYG+OAQTYS)/AORUNS*COALESCE((C1.IHCNV1/C1.IHCNV2),(C2.IHCNV2/C2.IHCNV1),FLOAT(1))) RTIME, 
	'EARNED' CODE
FROM
	LGDAT.RPRR
	INNER JOIN LGDAT.RPRH ON
		NWBTID = OABTID
	LEFT OUTER JOIN LGDAT.METHDR ON
		AOPART = OAPART AND
		AOPLNT = NWPLNT AND
		AOSEQ# = OASEQ#
	LEFT OUTER JOIN LGDAT.PUNIT C1 ON
  		C1.IHPART = OAPART AND
   		C1.IHUNT2 = OAUNIT AND
   		C1.IHUNT1 = AOUNIT
  	LEFT OUTER JOIN LGDAT.PUNIT C2 ON
   		C2.IHPART = OAPART AND
   		C2.IHUNT1 = OAUNIT AND
   		C2.IHUNT2 = AOUNIT
	LEFT OUTER JOIN LGDAT.RESRE ON
   		ABDEPT = AODEPT AND
   		ABRESC = AORESC
  	LEFT OUTER JOIN LGDAT.DEPTS ON
   		ABDEPT = AADEPT
	LEFT OUTER JOIN LGDAT.STKA ON
		V6PART = OAPART AND
		V6PLNT = NWPLNT
WHERE
	NWFSYY = 14
GROUP BY
	NWFSYY||DIGITS(NWFSPP), NWPLNT, OADEPT, OARESC, AORESC, AODEPT,V6STAT, V6RPLN, 
	CASE ABVBRD WHEN 0 THEN IFNULL(AAVBRD,0) ELSE IFNULL(ABVBRD,0) END+CASE ABBRDR WHEN 0 THEN IFNULL(AABRDR,0) ELSE IFNULL(ABBRDR,0) END

) X
GROUP BY
	PERD, RTYPE, NWPLNT, ADEPT, ARESC, STAT, RPLN, SDEPT, SRESC, RRATE, CODE
FETCH FIRST 10 ROWS ONLY