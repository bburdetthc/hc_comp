SELECT 
	'STKT' SRCE,
	YACOMP||Y1INVA AS ACCT,
	SUBSTR(STKT.BYFSYY,3,2)||DIGITS(STKT.BYFSPR) AS PERIOD, 
	SUBSTR(YACOMP||Y1INVA,7,4) AS PRIME,
	ROUND(SUM(STKT.BYQTY*COALESCE(FCOST, CGSTCS,CHSTCS,Y0STCS)*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2) AS HISTAMNT,
	ROUND(SUM(STKT.BYQTY*COALESCE(FCOST, CGSTCS,CHSTCS,Y0STCS)*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2)  AS CURRAMNT,
	ROUND(SUM(F.JHTOTN*BYQTY*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2) 		FTOT, 
	ROUND(SUM((F.JHMATN+F.JHTOTN-F.JHMATN-F.JHLABN-F.JHBURN-F.JHOTHN-F.JHSHCN-F.JHAVDN-F.JHCRCN)*BYQTY*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2)	FMAT, 
	ROUND(SUM(F.JHSHCN*BYQTY*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2) 		FSHH, 
	ROUND(SUM(F.JHAVDN*BYQTY*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2) 		FDUT, 
	ROUND(SUM(F.JHCRCN*BYQTY*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2) 		FCRN, 
	ROUND(SUM(F.JHLABN*BYQTY*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2) 		FLAB, 
	ROUND(SUM(F.JHBRVN*BYQTY*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2) 		FVAR,
	ROUND(SUM(F.JHBRFN*BYQTY*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2)		FFIX, 
	ROUND(SUM(F.JHOTHN*BYQTY*CASE STKT.BYACTN WHEN 'R' THEN 1 ELSE -1 END),2) 		FOTH
FROM 
	LGDAT.STKT STKT
	LEFT OUTER JOIN LGDAT.ICSTP P ON
		CHPART = STKT.BYPART AND
		CHPLNT = STKT.BYPLNT
	LEFT OUTER JOIN LGDAT.ICSTM M ON
		CGPART = STKT.BYPART AND
		CGPLNT = STKT.BYPLNT
	LEFT OUTER JOIN LGDAT.ICSTR R ON
		Y0PART = STKT.BYPART AND
		Y0PLNT = STKT.BYPLNT
	LEFT OUTER JOIN QGPL.FFCOSTEFFD ON
		PART = BYPART AND
		PLNT = BYPLNT AND
		CHAR(FDT)||CHAR(FTM) < CHAR(BYSDAT)||CHAR(BYSTIM) AND
		CHAR(TDT)||CHAR(TTM) > CHAR(BYSDAT)||CHAR(BYSTIM)
	LEFT OUTER JOIN LGDAT.STKMP MP ON
		MP.AWPART = BYPART
	LEFT OUTER JOIN LGDAT.STKMM MM ON
		MM.AVPART = BYPART
	LEFT OUTER JOIN LGDAT.GLIE A ON
		Y1GLEC = COALESCE(AVGLED, AWGLED) AND
		Y1PLNT = BYPLNT
	LEFT OUTER JOIN LGDAT.PLNT L ON
		YAPLNT = BYPLNT
	LEFT OUTER JOIN LGDAT.ICSTT F ON
		JHPART = BYPART AND
		JHPLNT = BYPLNT AND
		JHRCID = FRI
WHERE
	STKT.BYFSYY IN (2012,2013,2014) AND 
	STKT.BYACTN IN ('I','R') AND BYSRC = 'PD ' AND
	SUBSTR(YACOMP||Y1INVA,7,4) = '1220'
GROUP BY
	YACOMP||Y1INVA, 
	SUBSTR(STKT.BYFSYY,3,2)||DIGITS(STKT.BYFSPR),
	SUBSTR(YACOMP||Y1INVA,7,4)
FETCH FIRST 10 ROWS ONLY