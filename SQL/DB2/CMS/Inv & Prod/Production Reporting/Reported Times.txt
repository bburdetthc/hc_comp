SELECT
	PERD, NWPLNT, ADEPT, ARESC, STAT, RPLN, OPTR, SDEPT, SRESC, RRATE, 
	SUM(OAQTYG) QTYG,
	SUM(OAQTYS) QTYS,
	SUM(STIME) STIME,
	SUM(RTIME) RTIME,
	SUM(DTIME) DTIME,
	SUM(ABSLAB) ABSLAB,
	SUM(ABSOVH) ABSOVH,
	CODE
FROM
(
-----------------------------DOWNTIME--------------------------------------------
SELECT
	NWFSYY||DIGITS(NWFSPP) PERD, NWPLNT, NXDEPT ADEPT, NXRESC ARESC, '' STAT, '' RPLN, 0 OPTR, '' SDEPT, '' SRESC, 
	0 RRATE, 
	0 OAQTYG, 0 OAQTYS,
	0 STIME,
	0 RTIME,
	SUM(NXTIME) DTIME,
	0 ABSLAB,
	0 ABSOVH,
	RTRIM(NXINDC)||' - '||RTRIM(AFDES1) CODE
FROM
	LGDAT.RPRH 
	INNER JOIN LGDAT.RPRD ON
		NWBTID = NXBTID
	LEFT OUTER JOIN LGDAT.INDLBR ON
		AFCODE = NXINDC
WHERE
	NWFSYY = 14
GROUP BY
	NWFSYY||DIGITS(NWFSPP), NWPLNT, NXDEPT, NXRESC,RTRIM(NXINDC)||' - '||RTRIM(AFDES1)

UNION ALL

--------------------------------RUN TIME----------------------------------------
SELECT
	NWFSYY||DIGITS(NWFSPP) PERD, NWPLNT, OADEPT ADEPT, OARESC ARESC, V6STAT STAT, V6RPLN RPLN, V6OPTR OPTR,AODEPT SDEPT, AORESC SRESC,
	CASE ABVBRD WHEN 0 THEN IFNULL(AAVBRD,0) ELSE IFNULL(ABVBRD,0) END+CASE ABBRDR WHEN 0 THEN IFNULL(AABRDR,0) ELSE IFNULL(ABBRDR,0) END RRATE,
	0 OAQTYG, 0 OAQTYS,
	0 STIME,
	SUM(OATIME) RTIME, 
	0 DTIME,
	0 ABSLAB, 0 ABSOVH,
	'02 - RUN' CODE
FROM
	LGDAT.RPRR
	INNER JOIN LGDAT.RPRH ON
		NWBTID = OABTID
	LEFT OUTER JOIN LGDAT.METHDR ON
		AOPART = OAPART AND
		AOPLNT = NWPLNT AND
		AOSEQ# = OASEQ#
	LEFT OUTER JOIN LGDAT.PUNIT C1 ON
  		C1.IHPART = OAPART AND
   		C1.IHUNT2 = OAUNIT AND
   		C1.IHUNT1 = AOUNIT
  	LEFT OUTER JOIN LGDAT.PUNIT C2 ON
   		C2.IHPART = OAPART AND
   		C2.IHUNT1 = OAUNIT AND
   		C2.IHUNT2 = AOUNIT
	LEFT OUTER JOIN LGDAT.RESRE ON
   		ABDEPT = AODEPT AND
   		ABRESC = AORESC
  	LEFT OUTER JOIN LGDAT.DEPTS ON
   		ABDEPT = AADEPT
	LEFT OUTER JOIN LGDAT.STKA ON
		V6PART = OAPART AND
		V6PLNT = NWPLNT
WHERE
	NWFSYY = 14
GROUP BY
	NWFSYY||DIGITS(NWFSPP), NWPLNT, OADEPT, OARESC, AORESC, AODEPT,V6STAT, V6RPLN, V6OPTR,
	CASE ABVBRD WHEN 0 THEN IFNULL(AAVBRD,0) ELSE IFNULL(ABVBRD,0) END+CASE ABBRDR WHEN 0 THEN IFNULL(AABRDR,0) ELSE IFNULL(ABBRDR,0) END

UNION ALL

-------------------------------------EARNED HOURS------------------------------------------------
SELECT
	NWFSYY||DIGITS(NWFSPP) PERD, NWPLNT, OADEPT ADEPT, OARESC ARESC, V6STAT STAT, V6RPLN RPLN, V6OPTR OPTR, AODEPT SDEPT, AORESC SRESC,
	(
		CASE ABVBRD WHEN 0 THEN IFNULL(AAVBRD,0) ELSE IFNULL(ABVBRD,0) END+
		CASE ABBRDR WHEN 0 THEN IFNULL(AABRDR,0) ELSE IFNULL(ABBRDR,0) END
	) RRATE,
	SUM(OAQTYG) OAQTYG, 
	SUM(OAQTYS) OAQTYS,
	SUM(
		(CASE IFNULL(AORUNS,0) WHEN 0 THEN 0 ELSE 1/AORUNS END+AOSETP/1000000)*
		FLOAT(OAQTYG+OAQTYS)*
		COALESCE((C1.IHCNV1/C1.IHCNV2),(C2.IHCNV2/C2.IHCNV1),FLOAT(1))) STIME, 
	0 RTIME,
	0 DTIME,
	SUM(
		CASE ABLABR WHEN 0 THEN IFNULL(AASTDR,0) ELSE IFNULL(ABLABR,0) END*
		(CASE IFNULL(AORUNS,0) WHEN 0 THEN 0 ELSE 1/AORUNS END*AO#MEN/AO#MCH+AOSETP*AOSCRW/1000000)*
		FLOAT(OAQTYG+OAQTYS)*
		COALESCE((C1.IHCNV1/C1.IHCNV2),(C2.IHCNV2/C2.IHCNV1),FLOAT(1))
	) ABSLAB,
	SUM(
		(CASE ABVBRD WHEN 0 THEN IFNULL(AAVBRD,0) ELSE IFNULL(ABVBRD,0) END+CASE IFNULL(ABBRDR,0) WHEN 0 THEN IFNULL(AABRDR,0) ELSE IFNULL(ABBRDR,0) END)*
		(CASE IFNULL(AORUNS,0) WHEN 0 THEN 0 ELSE 1/AORUNS END+AOSETP/1000000)*
		FLOAT(OAQTYG+OAQTYS)*
		COALESCE((C1.IHCNV1/C1.IHCNV2),(C2.IHCNV2/C2.IHCNV1),FLOAT(1))
	) ABSOVH,
	'01 - EARNED' CODE
FROM
	LGDAT.RPRR
	INNER JOIN LGDAT.RPRH ON
		NWBTID = OABTID
	LEFT OUTER JOIN LGDAT.METHDR ON
		AOPART = OAPART AND
		AOPLNT = NWPLNT AND
		AOSEQ# = OASEQ#
	LEFT OUTER JOIN LGDAT.PUNIT C1 ON
  		C1.IHPART = OAPART AND
   		C1.IHUNT2 = OAUNIT AND
   		C1.IHUNT1 = AOUNIT
  	LEFT OUTER JOIN LGDAT.PUNIT C2 ON
   		C2.IHPART = OAPART AND
   		C2.IHUNT1 = OAUNIT AND
   		C2.IHUNT2 = AOUNIT
	LEFT OUTER JOIN LGDAT.RESRE ON
   		ABDEPT = AODEPT AND
   		ABRESC = AORESC
  	LEFT OUTER JOIN LGDAT.DEPTS ON
   		ABDEPT = AADEPT
	LEFT OUTER JOIN LGDAT.STKA ON
		V6PART = OAPART AND
		V6PLNT = NWPLNT
WHERE
	NWFSYY = 14 AND
	AORESC <> ''
GROUP BY
	NWFSYY||DIGITS(NWFSPP), NWPLNT, OADEPT, OARESC, AORESC, AODEPT,V6STAT, V6RPLN, V6OPTR,
	CASE ABVBRD WHEN 0 THEN IFNULL(AAVBRD,0) ELSE IFNULL(ABVBRD,0) END+CASE ABBRDR WHEN 0 THEN IFNULL(AABRDR,0) ELSE IFNULL(ABBRDR,0) END
) X
GROUP BY
	PERD, NWPLNT, ADEPT, ARESC, STAT, RPLN, OPTR, SDEPT, SRESC, RRATE, CODE