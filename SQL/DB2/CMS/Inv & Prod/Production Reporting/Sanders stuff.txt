SELECT
	--need to add mold & color, reference file used to update scrap rates
	--nix the group codes
 	UIDEPT, UIRESC, CHAR(UIDATE) AS UIDATE, UIMTLP, 
	IFNULL(AVMAJG,AWMAJG) MAJG, 
   	IFNULL(AVMING,AWMING)||' - '||RTRIM(MMGP.BRDES) MING, 
     	SUM(UITQTY*CASE UIRQBY WHEN 'B' THEN -1 ELSE 1 END) AS QTY
FROM 
 	LGDAT.RPRM
	INNER JOIN LGDAT.PRTRAN ON
		IXWRKO = UIJOB# AND
		IXBTCH = UIBTID
  	LEFT OUTER JOIN LGDAT.STKMP SP ON
  		SP.AWPART = UIMTLP
 	LEFT OUTER JOIN LGDAT.STKMM SM ON
  		SM.AVPART = UIMTLP
	LEFT OUTER JOIN LGDAT.MMGP MMGP ON
    		MMGP.BRMGRP = COALESCE(AVMING, AWMING) AND
    		MMGP.BRGRP = COALESCE(AVMAJG, AWMAJG) 
WHERE
	IXPART = 'XRD16000X56E001' AND
	SUBSTR(IXDEPT,1,3) = '152' AND
	IXFSYY||DIGITS(IXFSPP) >= '1310'
GROUP BY
	UIDEPT, UIRESC, CHAR(UIDATE), UIMTLP, 
	IFNULL(AVMAJG,AWMAJG), 
   	IFNULL(AVMING,AWMING)||' - '||RTRIM(MMGP.BRDES)	