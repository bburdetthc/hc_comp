SELECT
	UZPART, UZPLNT, UZSEQ#,
	ROUND((UZL1MT+UZL2MT+UZL2LB+UZL2BF+UZL2BV+UZL2OT)*(FLOAT(AOEFF)/100),10) LOWLEV,
	ROUND(UZL1LB*(FLOAT(AOEFF)/100),10) LAB,
	ROUND(UZL1BF*(FLOAT(AOEFF)/100),10) FIX,
	ROUND(UZL1BV*(FLOAT(AOEFF)/100),10) VAR,
	ROUND(UZL1OT*(FLOAT(AOEFF)/100),10) OSS,
	(P.CGSTCS)*(1-FLOAT(AOEFF)/100) SCRAP,
	UZL1LB+UZL1BD+UZL1MT TOTINC,
	P.CGSTCS,
	FLOAT(AOEFF)/100 SCRPRT,
	CASE ABLABR WHEN 0 THEN AASTDR ELSE ABLABR END*(1/AORUNS*AO#MEN/AO#MCH+AOSETP*AOSCRW/V6OPTR) LABC,
	CASE ABBRDR WHEN 0 THEN AABRDR ELSE ABBRDR END*(1/AORUNS+AOSETP/V6OPTR) FIXC,
	CASE ABVBRD WHEN 0 THEN AAVBRD ELSE ABVBRD END*(1/AORUNS+AOSETP/V6OPTR) VARC,
	ROUND(
		SUM(
			COALESCE(C.CGSTCS, CHSTCS, Y0STCS)*FLOAT(AQQPPC/AQQTYM)/FLOAT(1-AQSCRP/100)*CASE AQRQBY WHEN 'B' THEN -1 ELSE 1 END
		)
	,10) MATC,
	SUM(APCOST)
FROM
	LGDAT.PSSC
	LEFT OUTER JOIN LGDAT.METHDR ON
		AOPART = UZPART AND
		AOPLNT = UZPLNT AND
		AOSEQ# = UZSEQ#
	LEFT OUTER JOIN LGDAT.METHDM ON
		AQPART = UZPART AND
		AQPLNT = UZPLNT AND
		AQSEQ#	= UZSEQ#
	LEFT OUTER JOIN LGDAT.METHDO ON
		APPART = UZPART AND
		APPLNT = UZPLNT AND
		APSEQ# = UZSEQ#
	LEFT OUTER JOIN LGDAT.ICSTP ON
		CHPART = AQMTLP AND
		CHPLNT = AQPLNT
	LEFT OUTER JOIN LGDAT.ICSTM C ON
		C.CGPART = AQMTLP AND
		C.CGPLNT = AQPLNT
	LEFT OUTER JOIN LGDAT.ICSTR ON
		Y0PART = AQMTLP AND
		Y0PLNT = AQPLNT
	LEFT OUTER JOIN LGDAT.ICSTM P ON
		P.CGPART = UZPART AND
		P.CGPLNT = UZPLNT
	LEFT OUTER JOIN LGDAT.RESRE ON
		ABPLNT = AOPLNT AND
		ABRESC = AORESC
	LEFT OUTER JOIN LGDAT.DEPTS ON
		ABDEPT = AADEPT
	LEFT OUTER JOIN LGDAT.STKA ON
		V6PART = UZPART AND
		V6PLNT = UZPLNT
		
WHERE
	UZPART IN ('SDD10000G18E001')  AND
	UZPLNT = '152'
GROUP BY
	UZPART, UZPLNT, UZSEQ#,
	ROUND((UZL1MT+UZL2MT+UZL2LB+UZL2BF+UZL2BV+UZL2OT)*(FLOAT(AOEFF)/100),10),
	ROUND(UZL1LB*(FLOAT(AOEFF)/100),10),
	ROUND(UZL1BF*(FLOAT(AOEFF)/100),10),
	ROUND(UZL1BV*(FLOAT(AOEFF)/100),10),
	ROUND(UZL1OT*(FLOAT(AOEFF)/100),10),
	(P.CGSTCS)*(1-FLOAT(AOEFF)/100),
	UZL1LB+UZL1BD+UZL1MT,	
	FLOAT(AOEFF)/100,
	P.CGSTCS,
	CASE ABLABR WHEN 0 THEN AASTDR ELSE ABLABR END*(1/AORUNS*AO#MEN/AO#MCH+AOSETP*AOSCRW/V6OPTR),
	CASE ABBRDR WHEN 0 THEN AABRDR ELSE ABBRDR END*(1/AORUNS+AOSETP/V6OPTR) ,
	CASE ABVBRD WHEN 0 THEN AAVBRD ELSE ABVBRD END*(1/AORUNS+AOSETP/V6OPTR)

