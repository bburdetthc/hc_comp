SELECT
	DXPLNT,
	CHAR(DXDATE) DXDATE,
	DXDEPT,
	DXWKCR,
	AQMTLP,
	RTRIM(COALESCE(AWMAJG, AVMAJG)||' - '||BQDES) MAJG, 
	RTRIM(COALESCE(AWMING, AVMING)||' - '||BRDES) MING,
	AQUNIT,
	SUM(FLOAT(AQQPPC/AQQTYM)/FLOAT(1-AQSCRP/100)*CASE AQRQBY WHEN 'B' THEN -1 ELSE 1 END*DXQTYR) EXTQTY
FROM
	LGDAT.SOFT
	INNER JOIN LGDAT.METHDM ON
		AQPART = DXPART AND
		AQPLNT = DXPLNT AND
		AQSEQ# = DXSEQN
	LEFT OUTER JOIN LGDAT.STKMM ON
		AVPART = AQMTLP
	LEFT OUTER JOIN LGDAT.STKMP ON
		AWPART = AQMTLP
	LEFT OUTER JOIN LGDAT.MAJG ON
		BQGRP = COALESCE(AVMAJG, AWMAJG)
	LEFT OUTER JOIN LGDAT.MMGP ON
		BRGRP = COALESCE(AVMAJG, AWMAJG) AND
		BRMGRP = COALESCE(AVMING, AWMING)
WHERE
	DXACTN = 'R' AND
	DXPLNT = '152'
GROUP BY
	DXPLNT,
	CHAR(DXDATE),
	DXDEPT,
	DXWKCR,
	AQMTLP,
	RTRIM(COALESCE(AWMAJG, AVMAJG)||' - '||BQDES), 
	RTRIM(COALESCE(AWMING, AVMING)||' - '||BRDES),
	AQUNIT