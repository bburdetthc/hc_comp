SELECT
	X.*, PCOSTX-CCOSTX FPV
FROM
(
SELECT
	DXJOBN,
	DXSEQN,
	DXDATE,
	DXSTIM,
	DXETIM,
	DXTMZN,
	DXDEPT,
	DXWKCR,
	DXPART,
	DXACTN,
	DXQTYR,
	DXLAOP,
	DXLOAD,
	DXREPS,
	DXSET,
	DXFUT1,
	DXRSRC,
	DXPRSC,
	DXPLNT,
	AP.V6RPLN,
	AP.V6STAT,
	COALESCE(PM.CGSTCS, PP.CHSTCS, PR.Y0STCS) PCOST,
	COALESCE(PM.CGSTCS, PP.CHSTCS, PR.Y0STCS)*DXQTYR PCOSTX,
	SUM(
		FLOAT(AQQPPC/AQQTYM)/FLOAT(1-AQSCRP/100)*
		CASE AQRQBY WHEN 'B' THEN -1 ELSE 1 END*
		COALESCE(CM.CGSTCS, CP.CHSTCS, CR.Y0STCS)*
		CASE SUBSTR(COALESCE(SPC.AWGLED,SMC.AVGLED,'XXX'),1,1) 
			WHEN '1' THEN 1 
			WHEN '2' THEN 1 
			ELSE 0 
		END
	) CCOST,
	SUM(
		FLOAT(AQQPPC/AQQTYM)/FLOAT(1-AQSCRP/100)*
		CASE AQRQBY WHEN 'B' THEN -1 ELSE 1 END*
		FLOAT(DXQTYR)*COALESCE(CM.CGSTCS, CP.CHSTCS, CR.Y0STCS)*
		CASE SUBSTR(COALESCE(SPC.AWGLED,SMC.AVGLED,'XXX'),1,1) 
			WHEN '1' THEN 1 
			WHEN '2' THEN 1 
			ELSE 0 
		END
	) CCOSTX
FROM
	LGDAT.SOFT SOFT
	INNER JOIN LGDAT.STKA AP ON
		AP.V6PART = DXPART AND
		AP.V6PLNT = DXPLNT
	LEFT OUTER JOIN LGDAT.ICSTM PM ON 
		PM.CGPART = AP.V6PART AND 
		PM.CGPLNT = AP.V6PLNT 
	LEFT OUTER JOIN LGDAT.ICSTP PP ON 
		PP.CHPART = AP.V6PART AND 
		PP.CHPLNT = AP.V6PLNT 
	LEFT OUTER JOIN LGDAT.ICSTR PR ON 
		PR.Y0PART = AP.V6PART AND 
		PR.Y0PLNT = AP.V6PLNT 
	LEFT OUTER JOIN LGDAT.METHDM ON
		AQPART = DXPART AND
		AQPLNT = DXPLNT
	LEFT OUTER JOIN LGDAT.STKA AC ON
		AC.V6PART = AQMTLP AND
		AC.V6PLNT = AQPLNT
	LEFT OUTER JOIN LGDAT.ICSTM CM ON 
		CM.CGPART = AC.V6PART AND 
		CM.CGPLNT = AC.V6PLNT 
	LEFT OUTER JOIN LGDAT.ICSTP CP ON 
		CP.CHPART = AC.V6PART AND 
		CP.CHPLNT = AC.V6PLNT 
	LEFT OUTER JOIN LGDAT.ICSTR CR ON 
		CR.Y0PART = AC.V6PART AND 
		CR.Y0PLNT = AC.V6PLNT 
	LEFT OUTER JOIN LGDAT.STKMM SMC ON
		SMC.AVPART = AQMTLP
	LEFT OUTER JOIN LGDAT.STKMP SPC ON
		SPC.AWPART = AQMTLP
	LEFT OUTER JOIN LGDAT.STKMM SMP ON
		SMP.AVPART = AQMTLP
	LEFT OUTER JOIN LGDAT.STKMP SPP ON
		SPP.AWPART = AQMTLP

--WHERE
--	SUBSTR(COALESCE(SPC.AWGLED,SMC.AVGLED,'XXX'),1,1) IN ('1','2')
GROUP BY
	DXJOBN,
	DXSEQN,
	DXDATE,
	DXSTIM,
	DXETIM,
	DXTMZN,
	DXDEPT,
	DXWKCR,
	DXPART,
	DXACTN,
	DXQTYR,
	DXLAOP,
	DXLOAD,
	DXREPS,
	DXSET,
	DXFUT1,
	DXRSRC,
	DXPRSC,
	DXPLNT,
	AP.V6RPLN,
	AP.V6STAT,
	COALESCE(PM.CGSTCS, PP.CHSTCS, PR.Y0STCS),
	COALESCE(PM.CGSTCS, PP.CHSTCS, PR.Y0STCS)*DXQTYR
) X
FETCH FIRST 10 ROWS ONLY