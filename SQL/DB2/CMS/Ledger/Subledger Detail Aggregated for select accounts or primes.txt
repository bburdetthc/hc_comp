--DECLARE GLOBAL TEMPORARY TABLE ALIST(ACCT CHAR(20))
/*
INSERT INTO QTEMP.ALIST
SELECT
	AZCOMP||DIGITS(AZGL#1)||DIGITS(AZGL#2) ACCT
FROM
	LGDAT.MAST
WHERE
	SUBSTR(AZCOMP||DIGITS(AZGL#1)||DIGITS(AZGL#2),7,4)='8206'
*/


/*
SELECT 		
	DIGITS(AZCOMP) AS COMP, SUBSTR(DKACC#,7,4) AS OBJ,
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END AS HYPACCT,	
	DKFSYY||DIGITS(DKFSPR) AS PERIOD,	
	SUM(DKAMT) AS AMOUNT, 
	DKSRCE||DKQUAL AS MODULE,
	CASE DKSRCE||DKQUAL 
 		WHEN 'APAC' THEN DKREFD 
 		WHEN 'APCQ' THEN DKREFD 
 		WHEN 'AP' THEN DKREFD
 		WHEN 'APVC' THEN SUBSTR(DKREFD,1,11)
 		WHEN 'APVN' THEN 'VOUCHER - '||LTRIM(RTRIM(DKREF#))||' '||LTRIM(RTRIM(DKREFD))||' '||LTRIM(RTRIM(DKADDD))
		ELSE 'X'
	END AS TRANTYPE
FROM 		
	LGDAT.GLSBAP	
	INNER JOIN QTEMP.ALIST ON
		DKACC# = ACCT
	LEFT OUTER JOIN LGDAT.MAST MAST ON	
		AZCOMP = SUBSTR(DKACC#,1,2) AND 
		AZGL#1 = SUBSTR(DKACC#,3,4) AND 
		AZGL#2 = SUBSTR(DKACC#,7,6)
	LEFT OUTER JOIN LGPGM.CMSTOHYP H ON	
		CMSGL = DKACC#
WHERE 		
	DKFSYR = 20 AND
	DKFSYY = 13
	
GROUP BY
	DIGITS(AZCOMP) , SUBSTR(DKACC#,7,4) , 
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END,
	DKFSYY||DIGITS(DKFSPR),
	DKSRCE||DKQUAL,
	CASE DKSRCE||DKQUAL 
 		WHEN 'APAC' THEN DKREFD 
 		WHEN 'APCQ' THEN DKREFD 
 		WHEN 'AP' THEN DKREFD
 		WHEN 'APVC' THEN SUBSTR(DKREFD,1,11)
 		WHEN 'APVN' THEN 'VOUCHER - '||LTRIM(RTRIM(DKREF#))||' '||LTRIM(RTRIM(DKREFD))||' '||LTRIM(RTRIM(DKADDD))
		ELSE 'X'
	END

UNION ALL

SELECT 		
	DIGITS(AZCOMP) AS COMP, SUBSTR(DKACC#,7,4) AS OBJ,
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END AS HYPACCT,	
	DKFSYY||DIGITS(DKFSPR) AS PERIOD,	
	SUM(DKAMT) AS AMOUNT, 
	DKSRCE||DKQUAL AS MODULE,
	CASE DKSRCE||DKQUAL
 		WHEN 'AR' THEN LTRIM(RTRIM(DKREFD))||' - '||LTRIM(RTRIM(DKADDD))
  		WHEN 'ARIN' THEN 'CREDIT MEMO - '||LTRIM(RTRIM(DKREFD))
  		WHEN 'ARRC' THEN 
			CASE LTRIM(RTRIM(SUBSTR(DKREFD,1,11)))
				WHEN 'ADJUSTMENT' THEN 'CASH APP - '||SUBSTR(DKREFD,1,11)||' - '||LTRIM(RTRIM(DKADDD))
				WHEN 'DISCOUNT' THEN 'CASH APP - '||SUBSTR(DKREFD,1,11)||' - '||LTRIM(RTRIM(DKADDD))
				ELSE 'CASH APP - '||LTRIM(RTRIM(SUBSTR(DKREFD,1,11)))
			END
  		WHEN 'OEIN' THEN 
			CASE SUBSTR(DKREF#,1,1) 
				WHEN 'I' THEN UPPER(LTRIM(RTRIM(DKREFD)))
				WHEN 'C' THEN 'CREDIT INVOICE - '||LTRIM(RTRIM(DKADDD))
				ELSE 'X'
			END
		ELSE 'X'
 	END AS TRANTYPE
FROM 		
	LGDAT.GLSBAR	
	INNER JOIN QTEMP.ALIST ON
		DKACC# = ACCT
	LEFT OUTER JOIN LGDAT.MAST MAST ON	
		AZCOMP = SUBSTR(DKACC#,1,2) AND 
		AZGL#1 = SUBSTR(DKACC#,3,4) AND 
		AZGL#2 = SUBSTR(DKACC#,7,6)
	LEFT OUTER JOIN LGPGM.CMSTOHYP H ON	
		CMSGL = DKACC#
WHERE 		
	DKFSYR = 20 AND
	DKFSYY = 13

GROUP BY
	DIGITS(AZCOMP) , SUBSTR(DKACC#,7,4) ,
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END,
	DKFSYY||DIGITS(DKFSPR),
	DKSRCE||DKQUAL,
	CASE DKSRCE||DKQUAL
 		WHEN 'AR' THEN LTRIM(RTRIM(DKREFD))||' - '||LTRIM(RTRIM(DKADDD))
  		WHEN 'ARIN' THEN 'CREDIT MEMO - '||LTRIM(RTRIM(DKREFD))
  		WHEN 'ARRC' THEN 
			CASE LTRIM(RTRIM(SUBSTR(DKREFD,1,11)))
				WHEN 'ADJUSTMENT' THEN 'CASH APP - '||SUBSTR(DKREFD,1,11)||' - '||LTRIM(RTRIM(DKADDD))
				WHEN 'DISCOUNT' THEN 'CASH APP - '||SUBSTR(DKREFD,1,11)||' - '||LTRIM(RTRIM(DKADDD))
				ELSE 'CASH APP - '||LTRIM(RTRIM(SUBSTR(DKREFD,1,11)))
			END
  		WHEN 'OEIN' THEN 
			CASE SUBSTR(DKREF#,1,1) 
				WHEN 'I' THEN UPPER(LTRIM(RTRIM(DKREFD)))
				WHEN 'C' THEN 'CREDIT INVOICE - '||LTRIM(RTRIM(DKADDD))
				ELSE 'X'
			END
		ELSE 'X'
 	END

UNION ALL

SELECT 		
	DIGITS(AZCOMP) AS COMP, SUBSTR(DKACC#,7,4) AS OBJ, 
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END AS HYPACCT,	
	DKFSYY||DIGITS(DKFSPR) AS PERIOD,	
	SUM(DKAMT) AS AMOUNT, 
	DKSRCE||DKQUAL AS MODULE,
	CASE DKSRCE||DKQUAL
  		WHEN 'IC' THEN SUBSTR(DKADDD,1,12)
  		WHEN 'ICIN' THEN SUBSTR(DKADDD,1,12)
  		WHEN 'ICIT' THEN SUBSTR(DKADDD,1,12)
  		WHEN 'ICRL' THEN SUBSTR(DKADDD,1,5)
  		WHEN 'ICVR' THEN SUBSTR(DKADDD,1,5)
  		WHEN 'PDWO' THEN 
   			CASE 
   				WHEN SUBSTR(DKREFD,1,7) IN ('COMPLET','CP- PO#','WIP ADJ','VOID CO','REV WIP') 
   				THEN SUBSTR(DKREFD,1,7) 
   				ELSE SUBSTR(DKADDD,1,24)
   			END
  		WHEN 'ICRT' THEN SUBSTR(DKADDD,1,12) ELSE 'X'
 	END AS TRANTYPE
FROM 		
	LGDAT.GLSBIV
	INNER JOIN QTEMP.ALIST ON
		DKACC# = ACCT
	LEFT OUTER JOIN LGDAT.MAST MAST ON	
		AZCOMP = SUBSTR(DKACC#,1,2) AND 
		AZGL#1 = SUBSTR(DKACC#,3,4) AND 
		AZGL#2 = SUBSTR(DKACC#,7,6)
	LEFT OUTER JOIN LGPGM.CMSTOHYP H ON	
		CMSGL = DKACC#
WHERE 		
	DKFSYR = 20 AND
	DKFSYY = 13
GROUP BY
	DIGITS(AZCOMP) , SUBSTR(DKACC#,7,4) , 
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END,
	DKFSYY||DIGITS(DKFSPR),
	DKSRCE||DKQUAL,
	CASE DKSRCE||DKQUAL
  		WHEN 'IC' THEN SUBSTR(DKADDD,1,12)
  		WHEN 'ICIN' THEN SUBSTR(DKADDD,1,12)
  		WHEN 'ICIT' THEN SUBSTR(DKADDD,1,12)
  		WHEN 'ICRL' THEN SUBSTR(DKADDD,1,5)
  		WHEN 'ICVR' THEN SUBSTR(DKADDD,1,5)
  		WHEN 'PDWO' THEN 
   			CASE 
   				WHEN SUBSTR(DKREFD,1,7) IN ('COMPLET','CP- PO#','WIP ADJ','VOID CO','REV WIP') 
   				THEN SUBSTR(DKREFD,1,7) 
   				ELSE SUBSTR(DKADDD,1,24)
   			END
  		WHEN 'ICRT' THEN SUBSTR(DKADDD,1,12) ELSE 'X'
 	END

UNION ALL

SELECT 		
	DIGITS(AZCOMP) AS COMP, SUBSTR(DKACC#,7,4) AS OBJ,
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END AS HYPACCT,	
	DKFSYY||DIGITS(DKFSPR) AS PERIOD,	
	SUM(DKAMT) AS AMOUNT, 
	DKSRCE||DKQUAL AS MODULE,
	'MJE - '||RTRIM(DKADDD)||' - '||RTRIM(DKREFD) AS TRANTYPE
FROM 		
	LGDAT.GTRAN	
	INNER JOIN QTEMP.ALIST ON
		DKACC# = ACCT
	LEFT OUTER JOIN LGDAT.MAST MAST ON	
		AZCOMP = SUBSTR(DKACC#,1,2) AND 
		AZGL#1 = SUBSTR(DKACC#,3,4) AND 
		AZGL#2 = SUBSTR(DKACC#,7,6)
	LEFT OUTER JOIN LGPGM.CMSTOHYP H ON	
		CMSGL = DKACC#
WHERE 		
	DKFSYR = 20 AND
	DKFSYY = 13 AND
	DKSRCE||DKQUAL IN ('GJJB','RJ')
GROUP BY
	DIGITS(AZCOMP) , SUBSTR(DKACC#,7,4) , 
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END,
	DKFSYY||DIGITS(DKFSPR),
	DKSRCE||DKQUAL,
	'MJE - '||RTRIM(DKADDD)||' - '||RTRIM(DKREFD)

UNION ALL

SELECT 		
	DIGITS(AZCOMP) AS COMP, SUBSTR(DKACC#,7,4) AS OBJ,
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END AS HYPACCT,	
	DKFSYY||DIGITS(DKFSPR) AS PERIOD,	
	SUM(DKAMT) AS AMOUNT, 
	DKSRCE||DKQUAL AS MODULE,
	'MJE - '||RTRIM(DKADDD)||' - '||RTRIM(DKREFD) AS TRANTYPE
FROM 		
	LGDAT.GTLYN	
	INNER JOIN QTEMP.ALIST ON
		DKACC# = ACCT
	LEFT OUTER JOIN LGDAT.MAST MAST ON	
		AZCOMP = SUBSTR(DKACC#,1,2) AND 
		AZGL#1 = SUBSTR(DKACC#,3,4) AND 
		AZGL#2 = SUBSTR(DKACC#,7,6)
	LEFT OUTER JOIN LGPGM.CMSTOHYP H ON	
		CMSGL = DKACC#
WHERE 		
	DKFSYR = 20 AND
	DKFSYY = 13 AND
	DKSRCE||DKQUAL IN ('GJJB','RJ')
GROUP BY
	DIGITS(AZCOMP) , SUBSTR(DKACC#,7,4) , 
	CASE
		WHEN DKFSYY||DIGITS(DKFSPR) <= '1306' THEN HYPNEW 
		ELSE HYPOLD
	END,
	DKFSYY||DIGITS(DKFSPR),
	DKSRCE||DKQUAL,
	'MJE - '||RTRIM(DKADDD)||' - '||RTRIM(DKREFD)
*/
--DROP TABLE QTEMP.ALIST