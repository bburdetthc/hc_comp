SELECT
	V6PART, V6PLNT, V6STAT, V6RPLN, AOSEQ#,
	UZI1LB, ROUND((1/AORUNS*AO#MEN/AO#MCH+AOSETP/COALESCE(CASE V6OPTR WHEN 0 THEN 1 ELSE V6OPTR END,1.0))/(FLOAT(AOEFF)/100)*CASE COALESCE(ABLABR,0) WHEN 0 THEN COALESCE(AASTDR,0) ELSE COALESCE(ABLABR,0) END,5) AS CALC,
	AORESC, AORUNS AS PCHR, ROUND(AO#MEN/AO#MCH,5) CREW, AOSETP/COALESCE(V6OPTR,1) AS SETHRS, AOSCRW AS SETCRW, FLOAT(AOEFF)/100 AS SCRAP, 
	COALESCE(CASE ABLABR WHEN 0 THEN AASTDR ELSE ABLABR END,0) AS RATE
FROM
	LGDAT.STKA
	INNER JOIN LGDAT.METHDR ON
		AOPART = V6PART AND
		AOPLNT = V6PLNT
	INNER JOIN LGDAT.PSSC ON
		UZPART = V6PART AND
		UZPLNT = V6PLNT AND
		UZSEQ# = AOSEQ#
	LEFT OUTER JOIN LGDAT.RESRE ON
		ABRESC = AORESC AND
		ABDEPT = AODEPT
	LEFT OUTER JOIN LGDAT.DEPTS ON
		AADEPT = AODEPT
WHERE
	V6PLNT IN ('152','154','112','113','114','155') AND
	V6STAT = 'A' AND
	V6RPLN = '1' AND
	V6PART <> '' AND
	AORESC <> '' AND
	UZI1LB - ROUND((1/AORUNS*AO#MEN/AO#MCH+AOSETP/COALESCE(CASE V6OPTR WHEN 0 THEN 1 ELSE V6OPTR END,1.0))/(FLOAT(AOEFF)/100)*COALESCE(CASE ABLABR WHEN 0 THEN AASTDR ELSE ABLABR END,0),5) <> 0 AND
	UZI1LB - ROUND((1/AORUNS*AO#MEN/AO#MCH+AOSETP/COALESCE(CASE V6OPTR WHEN 0 THEN 1 ELSE V6OPTR END,1.0))/(FLOAT(AOEFF)/100)*COALESCE(CASE ABLABR WHEN 0 THEN AASTDR ELSE ABLABR END,0) + .00001,5) <> 0 AND
	UZI1LB - ROUND((1/AORUNS*AO#MEN/AO#MCH+AOSETP/COALESCE(CASE V6OPTR WHEN 0 THEN 1 ELSE V6OPTR END,1.0))/(FLOAT(AOEFF)/100)*COALESCE(CASE ABLABR WHEN 0 THEN AASTDR ELSE ABLABR END,0) - .00001,5) <> 0