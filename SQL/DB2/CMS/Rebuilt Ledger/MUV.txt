SELECT
	B.NWPLNT, B.PERD, B.RDAT, B.ADEP, B.ARSC, B.WRKO, B.PART, B.RPLN, B.BTID, B.MAJG, B.MING,
	SUM(IFNULL(S.PQTY,0)) SQTY, SUM(IFNULL(S.AMNT,0)) SCST, 
	SUM(IFNULL(A.PQTY,0)) AQTY, SUM(IFNULL(A.AMNT,0)) ACST,
	SUM(IFNULL(P.AMNT,0)) OBPV
FROM
(
SELECT DISTINCT
	NWPLNT, DIGITS(NWFSYY)||DIGITS(NWFSPP) PERD, CHAR(NWRDAT) RDAT, ADEP, ARSC, BTID, ENT#, WRKO, PART, RPLN, 
	RTRIM(COALESCE(AWMAJG, AVMAJG)||' - '||BQDES) MAJG, 
	RTRIM(COALESCE(AWMING, AVMING)||' - '||BRDES) MING
FROM
	QGPL.FFPDGLR1
	INNER JOIN LGDAT.RPRH ON
		NWBTID = BTID
	LEFT OUTER JOIN LGDAT.STKMP ON
		AWPART = PART
	LEFT OUTER JOIN LGDAT.STKMM ON
		AVPART = PART
	LEFT OUTER JOIN LGDAT.MAJG ON
		BQGRP = COALESCE(AVMAJG, AWMAJG)
	LEFT OUTER JOIN LGDAT.MMGP ON
		BRGRP = COALESCE(AVMAJG, AWMAJG) AND
		BRMGRP = COALESCE(AVMING, AWMING)
WHERE
	SUBSTR(ACCT,7,4) = '6400' AND
	NWFSYY = 14 AND
	NWFSPP = 6 AND
	ACTN IN ('SBG','SBS','ABT','OBP')
) B
	LEFT OUTER JOIN QGPL.FFPDGLR1 S ON
		S.BTID = B.BTID AND
		S.WRKO = B.WRKO AND
		S.PART = B.PART AND
		S.ADEP = B.ADEP AND
		S.ARSC = B.ARSC AND
		S.ENT# = B.ENT# AND
		S.ACTN IN ('SBG','SBS')
	LEFT OUTER JOIN QGPL.FFPDGLR1 A ON
		A.BTID = B.BTID AND
		A.WRKO = B.WRKO AND
		A.PART = B.PART AND
		A.ADEP = B.ADEP AND
		A.ARSC = B.ARSC AND
		A.ENT# = B.ENT# AND
		A.ACTN = 'ABT'
	LEFT OUTER JOIN QGPL.FFPDGLR1 P ON
		P.BTID = B.BTID AND
		P.WRKO = B.WRKO AND
		P.PART = B.PART AND
		P.ADEP = B.ADEP AND
		P.ARSC = B.ARSC AND
		P.ENT# = B.ENT# AND
		P.ACTN = 'OBP'

GROUP BY
	B.NWPLNT, B.PERD, B.RDAT, B.ADEP, B.ARSC, B.BTID, B.WRKO, B.PART, B.RPLN, B.MAJG, B.MING
ORDER BY WRKO