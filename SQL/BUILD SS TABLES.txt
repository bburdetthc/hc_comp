WITH RECURSIVE TD
(SCH, TBL, FLD,POS)
AS
(
SELECT 
	TABLE_SCHEMA, 
	TABLE_NAME, 
	CAST(
		COLUMN_NAME||' '||
		CASE DATA_TYPE 
			WHEN 'CHAR' THEN 'VARCHAR' 
			WHEN 'GRAPHIC' THEN 'VARCHAR' 
			WHEN 'TIMESTMP' THEN 'TIME' 
			ELSE DATA_TYPE 
		END||
		CASE DATA_TYPE 
			WHEN 'DATE' THEN '' 
			WHEN 'TIMESTMP' THEN '' 
			ELSE '('||LENGTH||COALESCE(','||NUMERIC_SCALE||')',')') 
		END
		AS VARCHAR(32000)
	), 
	ORDINAL_POSITION
FROM 
	QSYS2.SYSCOLUMNS 
WHERE 
	TABLE_NAME IN 
(
		SELECT
			T.TABLE_NAME
		FROM
			QSYS2.SYSTABLES T
			INNER JOIN QSYS2.SYSTABLESTAT S ON
				T.TABLE_SCHEMA = S.TABLE_SCHEMA AND
				T.TABLE_NAME = S.TABLE_NAME
		WHERE
			T.TABLE_SCHEMA = 'LGDAT' AND 
			T.TABLE_TYPE IN ('P','T') AND 
			T.TABLE_NAME IN ('STKA','ICSTT','GLMT')
	) AND  
	TABLE_SCHEMA = 'LGDAT' AND 
	ORDINAL_POSITION = 1

UNION ALL

SELECT 
	TABLE_SCHEMA, 
	TABLE_NAME, 
	FLD||','||COLUMN_NAME||' '||
	CASE DATA_TYPE 
		WHEN 'CHAR' THEN 'VARCHAR' 
		WHEN 'GRAPHIC' THEN 'VARCHAR' 
		WHEN 'TIMESTMP' THEN 'TIME' 
		ELSE DATA_TYPE 
	END||
	CASE DATA_TYPE 
		WHEN 'DATE' THEN '' 
		WHEN 'TIMESTMP' THEN '' 
		ELSE '('||LENGTH||COALESCE(','||NUMERIC_SCALE||')',')') 
	END,
	ORDINAL_POSITION
FROM 
	QSYS2.SYSCOLUMNS 
	INNER JOIN TD ON
		TABLE_NAME = TBL AND
		TABLE_SCHEMA = SCH AND
		ORDINAL_POSITION = POS+1
WHERE 
	-----max recursion which equates to max number of columns
	POS < 250
)
SELECT 
	'CREATE TABLE '||SCH||'.'||TBL||' ('||MAX(FLD)||');' 
FROM 
	TD 
GROUP BY 
	SCH, TBL