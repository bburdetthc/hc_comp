SELECT
	CAST(YACOMP AS VARCHAR(2))+CAST(Y1INVA AS VARCHAR(10)) ACCT,
	SUBSTRING(CAST(YACOMP AS VARCHAR(2))+CAST(Y1INVA AS VARCHAR(10)),7,4) PRIME,
	B.PERD FSPR,
	PLNT,
	PART,
	STOK+' - '+RTRIM(AXLOCN) ILOC,
	COALESCE(AVMAJG,AWMAJG)+' - '+RTRIM(BQDES) MAJG,
	COALESCE(AVMING,AWMING)+' - '+RTRIM(BRDES) MING,
	COALESCE(AVMAJS,AWMAJS)+' - '+RTRIM(MS.BSDES1) MAJS,
	COALESCE(AVMINS,AWMINS)+' - '+RTRIM(NS.BSDES1) MINS,
	COALESCE(AVGLCD,AWGLDC)+' - '+RTRIM(GD.A30) GLDC,
	COALESCE(AVGLED,AWGLED)+' - '+RTRIM(GE.A30) GLEC,
	V6STAT,
	V6RPLN,
	QTYOH,
	QTYOH*COST_EFF EXT_COST,
	QTYOH*COST_EFF*RATE EXT_COST_USD
FROM
	R.STKB B
	LEFT OUTER JOIN LGDAT.STKR R ON
		AXSTKL = STOK
	LEFT OUTER JOIN LGDAT.STKMM ON
		AVPART = PART
	LEFT OUTER JOIN LGDAT.STKMP ON
		AWPART = PART
	LEFT OUTER JOIN LGDAT.MAJG ON
		BQGRP = COALESCE(AVMAJG ,AWMAJG)
	LEFT OUTER JOIN LGDAT.MMSL MS ON
		MS.BSMJCD = COALESCE(AVMAJS,AWMAJS) AND
		MS.BSMNCD = ''
	LEFT OUTER JOIN LGDAT.MMSL NS ON
		NS.BSMJCD = COALESCE(AVMAJS,AWMAJS) AND
		NS.BSMNCD = COALESCE(AVMINS,AWMINS)
	LEFT OUTER JOIN LGDAT.MMGP ON
		BRGRP = COALESCE(AVMAJG ,AWMAJG) AND
		BRMGRP = COALESCE(AVMING ,AWMING)
	LEFT OUTER JOIN LGDAT.CODE GE ON
		RTRIM(LTRIM(GE.A9)) = COALESCE(AWGLED, AVGLED) AND
		GE.A2 = 'GE'
	LEFT OUTER JOIN LGDAT.CODE GD ON
		RTRIM(LTRIM(GD.A9)) = COALESCE(AVGLCD ,AWGLDC) AND
		GD.A2 = 'EE'
	LEFT OUTER JOIN LGDAT.GLIE ON
		Y1PLNT = B.PLNT AND
		Y1GLEC = COALESCE(AWGLED, AVGLED)
	LEFT OUTER JOIN LGDAT.PLNT ON
		YAPLNT = B.PLNT
	LEFT OUTER JOIN LGDAT.STKA ON
		V6PART = B.PART AND
		V6PLNT = B.PLNT
	LEFT OUTER JOIN LGDAT.MAST ON
		CAST(AZCOMP AS VARCHAR(2))+AZCODE = CAST(YACOMP AS VARCHAR(2))+CAST(Y1INVA AS VARCHAR(10))
	LEFT OUTER JOIN R.FFCRET X ON
		FCUR = AZFUT2 AND
		TCUR = 'US' AND
		RTYP = 'ME' AND
		X.PERD = B.PERD
WHERE
	B.PERD = '1612'

OPTION (MAXDOP 8)